<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>How to get the physical caret position in a TMemo, TEdit or TRichEdit</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="How to get the physical caret position in a TMemo, TEdit or TRichEdit" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="canonical" href="http://delphidabbler.com/tips/103" />
<link rel="stylesheet" href="../css/main.css" />
<link rel="stylesheet" href="../css/main-multicol-scr.css" media="screen" />
<link rel="stylesheet" href="../css/main-2col-scr.css" media="screen" />
<script type="text/javascript" src="../js/core.js"></script>
<script type="text/javascript" src="../js/offsite-win.js"></script>
<link rel="stylesheet" href="../css/tips.css" />
<script type="text/javascript" src="../js/popup-win.js"></script>
<script type="text/javascript" src="../js/show-hide.js"></script>
<link rel="alternate" href="/feeds/site-news-feed?id=tips" type="application/rss+xml" title="DelphiDabbler.com Tips News" />
<link rel="stylesheet" href="../css/source.css" />
<link rel="stylesheet" href="../css/js-detect.css" />
<script type="text/javascript" src="../js/js-detect.js"></script>
</head>
<body>
<div id="wrapper">

<h1>
	How to get the physical caret position in a TMemo, TEdit or TRichEdit
</h1>

<div class="question">
  <div class="title">
    Question
  </div>
  <div class="content">
    How to get the caret position of a Memo or RichEdit control? I don't
    mean any character position expressed in row and column, I mean it in
    pixels!
  </div>
</div>

<p>
  You get the caret position in pixels (client relative) from an edit, memo or
  richedit control by sending it a <var>EM_POSFROMCHAR</var> message. The
  message parameters are different for a <var>TRichEdit</var> and
  <var>TMemo</var> / <var>TEdit</var>.
</p>

<p>
  <var>TRichEdit</var>:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">var</span>
<span class="pas-space">  </span><span class="pas-ident">pt</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">TPoint</span><span class="pas-sym">;</span>
<span class="pas-kwd">begin</span>
<span class="pas-space">  </span><span class="pas-kwd">with</span><span class="pas-space"> </span><span class="pas-ident">richedit1</span><span class="pas-space"> </span><span class="pas-kwd">do</span>
<span class="pas-space">  </span><span class="pas-kwd">begin</span>
<span class="pas-space">    </span><span class="pas-ident">Perform</span><span class="pas-sym">(</span><span class="pas-ident">messages</span><span class="pas-sym">.</span><span class="pas-ident">EM_POSFROMCHAR</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WPARAM</span><span class="pas-sym">(</span><span class="pas-sym">@</span><span class="pas-ident">pt</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">selstart</span><span class="pas-sym">)</span><span class="pas-sym">;</span>
<span class="pas-space">    </span><span class="pas-ident">label1</span><span class="pas-sym">.</span><span class="pas-ident">caption</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-ident">Format</span><span class="pas-sym">(</span><span class="pas-str">'(%d, %d)'</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-sym">[</span><span class="pas-ident">pt</span><span class="pas-sym">.</span><span class="pas-ident">x</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">pt</span><span class="pas-sym">.</span><span class="pas-ident">y</span><span class="pas-sym">]</span><span class="pas-sym">)</span><span class="pas-sym">;</span>
<span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span>
<span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
</div>

<p>
  <var>TMemo</var> and <var>TEdit</var>
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">var</span>
<span class="pas-space">  </span><span class="pas-ident">r</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">LongInt</span><span class="pas-sym">;</span>
<span class="pas-kwd">begin</span>
<span class="pas-space">  </span><span class="pas-kwd">with</span><span class="pas-space"> </span><span class="pas-ident">memo1</span><span class="pas-space"> </span><span class="pas-kwd">do</span>
<span class="pas-space">  </span><span class="pas-kwd">begin</span>
<span class="pas-space">    </span><span class="pas-ident">r</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-ident">Perform</span><span class="pas-sym">(</span><span class="pas-ident">messages</span><span class="pas-sym">.</span><span class="pas-ident">EM_POSFROMCHAR</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">selstart</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span>
<span class="pas-space">    </span><span class="pas-kwd">if</span><span class="pas-space"> </span><span class="pas-ident">r</span><span class="pas-space"> </span><span class="pas-sym">&gt;=</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-space"> </span><span class="pas-kwd">then</span>
<span class="pas-space">    </span><span class="pas-kwd">begin</span>
<span class="pas-space">      </span><span class="pas-ident">label1</span><span class="pas-sym">.</span><span class="pas-ident">caption</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-ident">IntToStr</span><span class="pas-sym">(</span><span class="pas-ident">HiWord</span><span class="pas-sym">(</span><span class="pas-ident">r</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span>
<span class="pas-space">      </span><span class="pas-ident">label2</span><span class="pas-sym">.</span><span class="pas-ident">caption</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-ident">IntToStr</span><span class="pas-sym">(</span><span class="pas-ident">LoWord</span><span class="pas-sym">(</span><span class="pas-ident">r</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span>
<span class="pas-space">    </span><span class="pas-kwd">end</span><span class="pas-sym">;</span><span class="pas-space">  </span>
<span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span>
<span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
</div>

<p>
  The <code>win32.hlp</code> entries for this message are really messed up, on
  older versions they only showed the memo variant, on newer (e.g. the one
  that comes with D5) they show only the richedit variant.
</p>

<table class="infotable">
  <tr>
    <th scope="row">Original resource:</th>
    <td>The Delphi Pool</td>
  </tr>
  <tr>
    <th scope="row">Author:</th>
    <td>Peter Below</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2009-09-14</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2009-09-14</td>
  </tr>
</table>



<div id="footer">
  Copyright &copy; Peter Johnson (<a href="https://gravatar.com/delphidabbler">DelphiDabbler</a>) 2002-2020
</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
