<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Simulate the Visual Basic SendKeys and AppActivate routines in Delphi</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="Simulate the Visual Basic SendKeys and AppActivate routines in Delphi" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="canonical" href="http://delphidabbler.com/tips/181" />
<link rel="stylesheet" href="/css/main.css" />
<link rel="stylesheet" href="/css/main-multicol-scr.css" media="screen" />
<link rel="stylesheet" href="/css/main-2col-scr.css" media="screen" />
<script type="text/javascript" src="/js/core.js"></script>
<script type="text/javascript" src="/js/offsite-win.js"></script>
<link rel="stylesheet" href="/css/tips.css" />
<script type="text/javascript" src="/js/popup-win.js"></script>
<script type="text/javascript" src="/js/show-hide.js"></script>
<link rel="alternate" href="/feeds/site-news-feed?id=tips" type="application/rss+xml" title="DelphiDabbler.com Tips News" />
<link rel="stylesheet" href="/css/source.css" />
<link rel="stylesheet" href="/css/js-detect.css" />
<script type="text/javascript" src="/js/js-detect.js"></script>
<script type="text/javascript">
  function showDemo(linkId, demoId) {
    showHide(linkId, demoId, 'Show demo code', 'Hide demo code');
  }
</script>
<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<script type="text/javascript">
    window.cookieconsent_options = {"message":"This site uses cookies to deliver its services, to enable targeted advertising and to support various social media buttons, and to analyse traffic. By using this site, you agree to its use of cookies.","dismiss":"Got it!","learnMore":"More info","link":"http://delphidabbler.com/subsid/cookies","theme":"dark-top"};
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
<!-- End Cookie Consent plugin -->
</head>
<body>
<!-- Facebook script -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="wrapper">
<div id="header">
<div class="hide-from-css">
<h1>DelphiDabbler.com</h1>
<p>Open source software, Delphi components, Tutorials &amp; more.</p>
</div> <!-- .hide-from-css -->
<div id="header-right">
<div id="quicklink" style="padding-right:4px;">
&raquo; <a href="/sitemap">Sitemap</a></div>
</div>
</div> <!-- #header -->
<div class="noprint" style="padding: 0 .5em .5em .5em; margin: .5em; background-color: #fcc;">
  <h2 class="smallcaps centre-align">
    &laquo;&laquo; Site Rescued &raquo;&raquo;
  </h2>
  <p class="highlight">
    While the site is still going to move from its current host, a new site will now take its place. <strong><a href="https://delphidabbler.blogspot.com/2020/03/delphidabblercom-is-no-longer-closing.html">More Info</a></strong>.
  </p>
  <p>
    The new site may have less content, but the core will now remain. And it will now play nicely with phones! Keep an eye on the <a href="https://delphidabbler.blogspot.com/">DelphiDabbler Blog</a> for news.
  </p>
</div>
<div id="navigation">
<hr class="hide-from-css" />
<h2 class="hide-from-css">Navigation</h2>
<ul>
<li><a href="/index">Home&nbsp;Page</a></li>
<li><a href="/programs">Programs</a></li>
<li><a href="/codelib">Delphi&nbsp;Library</a></li>
<li><a href="/snips-n-tips">Snippets&nbsp;&amp;&nbsp;Tips</a>
<ul>
<li class="sub-item"><a href="http://snippets.delphidabbler.com/" class="offsite-no-glyph">Code Snippets (Take 2)</a></li>
<li class="sub-item"><a href="/tips" class="selected ">Delphi&nbsp;Tips</a></li>
<li class="sub-item"><a href="http://swag.delphidabbler.com/" class="offsite-no-glyph">SWAG&nbsp;Archive</a></li>
</ul>
</li>
<li><a href="/articles">Articles</a></li>
<li><a href="http://wiki.delphidabbler.com/" class="offsite-no-glyph">Documentation</a></li>
<li><a href="/blog">Blog</a></li>
<li><a href="/news">News</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/background">About</a></li>
</ul>
</div> <!-- #navigation -->
<div id="main">
<div id="content">
<span class="help noprint">&raquo <a href="/help/tips-help.html" class="js-popup">Help</a></span>
<h1>
	Simulate the Visual Basic SendKeys and AppActivate routines in Delphi
</h1>

<div class="noprint">
<!-- style in following div and non-breaking spaces are a work around for a
     rendering bug in IE7 that sometimes hides preceeding h1 section if nothing
     is printed before this show_ads.js code is run.
     Tested and runs OK on Safari, Opera, Firefox, Chrome, but then, so did the
     original code! -->
<div class="centre-align" style="font-size:1pt;">&nbsp;
<script type="text/javascript"><!--
google_ad_client = "ca-pub-0907703677935617";
/* 468x60, created 11/04/09 */
google_ad_slot = "8060165044";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
&nbsp;
</div>
</div>
<p>
  This unit includes two routines that simulate popular Visual Basic routines:
  <var>Sendkeys</var> and <var>AppActivate</var>.  <var>SendKeys</var> takes
  <var>PChar</var> as its first parameter and a <var>Boolean</var> as its second,
  like so:
</p>

<div class="indent">
<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasHi -->
<div class="pas-source">
<pre class="line"><span class="pas-ident">SendKeys</span><span class="pas-sym">(</span><span class="pas-str">'KeyString'</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Wait</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
</div>
</div>
</div>

<p>
  where <var>KeyString</var> is a string of key names and modifiers that you
  want to send to the current input focus and <var>Wait</var> is a Boolean
  variable or value that indicates whether <var>SendKeys</var> should wait for
  each key message to be processed before proceeding. See the table below for
  more information.
</p>

<p>
  <var>AppActivate</var> also takes a <var>PChar</var> as its only parameter,
  like so:
</p>

<div class="indent">
<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasHi -->
<div class="pas-source">
<pre class="line"><span class="pas-ident">AppActivate</span><span class="pas-sym">(</span><span class="pas-str">'WindowName'</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
</div>
</div>
</div>

<p>
  where <var>WindowName</var> is the name of the window that you want to make
  the current input focus.
</p>

<p>
  <var>SendKeys</var> supports the Visual Basic <var>SendKeys</var> syntax, as
  documented below.
</p>

<div class="frame">
  <table>
    <caption>Supported modifiers</caption>
    <tr>
      <td style="width:10%;">+</td>
      <td>Shift</td>
    </tr>
    <tr>
      <td>^</td>
      <td>Control</td>
    </tr>
    <tr>
      <td>%</td>
      <td>Alt</td>
    </tr>
  </table>
</div>

<p>
  Surround sequences of characters or key names with parentheses in order to
  modify them as a group.  For example, '+abc' shifts only 'a', while '+(abc)'
  shifts all three characters.
</p>

<div class="frame">
  <table>
    <caption>Supported special characters</caption>
    <tr>
      <td style="width:10%;">~</td>
      <td>Enter</td>
    </tr>
    <tr>
      <td>(</td>
      <td>Begin modifier group (see above)</td>
    </tr>
    <tr>
      <td>)</td>
      <td>End modifier group (see above)</td>
    </tr>
    <tr>
      <td>{</td>
      <td>Begin key name text (see below)</td>
    </tr>
    <tr>
      <td>}</td>
      <td>End key name text (see below)</td>
    </tr>
  </table>
</div>

<p>
  Any character that can be typed is supported. Surround the modifier keys
  listed above with braces in order to send as normal text.
</p>

<p>
  Supported key names (surround these with braces):
</p>

<p class="indent">
  <code>BKSP, BS, BACKSPACE<br />
  BREAK<br />
  CAPSLOCK<br />
  CLEAR<br />
  DEL<br />
  DELETE<br />
  DOWN<br />
  END<br />
  ENTER<br />
  ESC<br />
  ESCAPE<br />
  F1<br />
  F2<br />
  F3<br />
  F4<br />
  F5<br />
  F6<br />
  F7<br />
  F8<br />
  F9<br />
  F10<br />
  F11<br />
  F12<br />
  F13<br />
  F14<br />
  F15<br />
  F16<br />
  HELP<br />
  HOME<br />
  INS<br />
  LEFT<br />
  NUMLOCK<br />
  PGDN<br />
  PGUP<br />
  PRTSC<br />
  RIGHT<br />
  SCROLLLOCK<br />
  TAB<br />
  UP<br /></code>
</p>

<p>
  Follow the keyname with a space and a number to send the specified key a given
  number of times (e.g., {left 6}).
</p>

<p>
  Here's the unit.
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasHi -->
<div class="pas-source">
<pre class="line"><span class="pas-kwd">unit</span><span class="pas-space"> </span><span class="pas-ident">sndkey32</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">interface</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Uses</span><span class="pas-space"> </span><span class="pas-ident">SysUtils</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Windows</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Messages</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Function</span><span class="pas-space"> </span><span class="pas-ident">SendKeys</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">Wait</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">function</span><span class="pas-space"> </span><span class="pas-ident">AppActivate</span><span class="pas-sym">(</span><span class="pas-ident">WindowName</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">{Buffer for working with PChar's}</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">const</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WorkBufLen</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-num">40</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WorkBuf</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">0</span><span class="pas-sym">..</span><span class="pas-ident">WorkBufLen</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">Char</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">implementation</span></pre>
<pre class="line"><span class="pas-kwd">type</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">THKeys</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">0</span><span class="pas-sym">..</span><span class="pas-ident">pred</span><span class="pas-sym">(</span><span class="pas-ident">MaxLongInt</span><span class="pas-sym">)</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">AllocationSize</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">integer</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">(*</span></pre>
<pre class="line"><span class="pas-comment">Converts a string of characters and key names to keyboard events and</span></pre>
<pre class="line"><span class="pas-comment">passes them to Windows.</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">Example syntax:</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">SendKeys('abc123{left}{left}{left}def{end}456{left 6}ghi{end}789', True);</span></pre>
<pre class="line"><span class="pas-comment">*)</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Function</span><span class="pas-space"> </span><span class="pas-ident">SendKeys</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">Wait</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">type</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WBytes</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">0</span><span class="pas-sym">..</span><span class="pas-ident">pred</span><span class="pas-sym">(</span><span class="pas-ident">SizeOf</span><span class="pas-sym">(</span><span class="pas-ident">Word</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">TSendKey</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-kwd">record</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">Name</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">ShortString</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">VKey</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">const</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-comment">{Array of keys that SendKeys recognizes.</span></pre>
<pre class="line"><span class="pas-comment">  If you add to this list, you must be sure to keep it sorted alphabetically</span></pre>
<pre class="line"><span class="pas-comment">  by Name because a binary search routine is used to scan it.}</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">MaxSendKeyRecs</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-num">41</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">SendKeyRecs</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">1</span><span class="pas-sym">..</span><span class="pas-ident">MaxSendKeyRecs</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">TSendKey</span><span class="pas-space"> </span><span class="pas-sym">=</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-sym">(</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'BACKSPACE'</span><span class="pas-sym">;</span><span class="pas-space">       </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_BACK</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'BKSP'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_BACK</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'BREAK'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_CANCEL</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'BS'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_BACK</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'CAPSLOCK'</span><span class="pas-sym">;</span><span class="pas-space">        </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_CAPITAL</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'CLEAR'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_CLEAR</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'DEL'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_DELETE</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'DELETE'</span><span class="pas-sym">;</span><span class="pas-space">          </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_DELETE</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'DOWN'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_DOWN</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'END'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_END</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'ENTER'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_RETURN</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'ESC'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_ESCAPE</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'ESCAPE'</span><span class="pas-sym">;</span><span class="pas-space">          </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_ESCAPE</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F1'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F1</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F10'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F10</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F11'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F11</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F12'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F12</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F13'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F13</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F14'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F14</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F15'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F15</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F16'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F16</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F2'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F2</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F3'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F3</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F4'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F4</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F5'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F5</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F6'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F6</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F7'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F7</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F8'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F8</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F9'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F9</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'HELP'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_HELP</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'HOME'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_HOME</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'INS'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_INSERT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'LEFT'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_LEFT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'NUMLOCK'</span><span class="pas-sym">;</span><span class="pas-space">         </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'PGDN'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_NEXT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'PGUP'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_PRIOR</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'PRTSC'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_PRINT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'RIGHT'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_RIGHT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'SCROLLLOCK'</span><span class="pas-sym">;</span><span class="pas-space">      </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_SCROLL</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'TAB'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_TAB</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'UP'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_UP</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-comment">{Extra VK constants missing from Delphi's Windows API interface}</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_NULL</span><span class="pas-sym">=</span><span class="pas-num">0</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_SemiColon</span><span class="pas-sym">=</span><span class="pas-num">186</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Equal</span><span class="pas-sym">=</span><span class="pas-num">187</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Comma</span><span class="pas-sym">=</span><span class="pas-num">188</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Minus</span><span class="pas-sym">=</span><span class="pas-num">189</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Period</span><span class="pas-sym">=</span><span class="pas-num">190</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Slash</span><span class="pas-sym">=</span><span class="pas-num">191</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_BackQuote</span><span class="pas-sym">=</span><span class="pas-num">192</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_LeftBracket</span><span class="pas-sym">=</span><span class="pas-num">219</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_BackSlash</span><span class="pas-sym">=</span><span class="pas-num">220</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_RightBracket</span><span class="pas-sym">=</span><span class="pas-num">221</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Quote</span><span class="pas-sym">=</span><span class="pas-num">222</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Last</span><span class="pas-sym">=</span><span class="pas-ident">VK_Quote</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ExtendedVKeys</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">set</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">byte</span><span class="pas-space"> </span><span class="pas-sym">=</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-sym">[</span><span class="pas-ident">VK_Up</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Down</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Left</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Right</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Home</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_End</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Prior</span><span class="pas-sym">,</span><span class="pas-space">  </span><span class="pas-comment">{PgUp}</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Next</span><span class="pas-sym">,</span><span class="pas-space">   </span><span class="pas-comment">{PgDn}</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Insert</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Delete</span><span class="pas-sym">]</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">const</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">INVALIDKEY</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-hex">$FFFF</span><span class="pas-space"> </span><span class="pas-comment">{Unsigned -1}</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-hex">$01</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VKKEYSCANCTRLON</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-hex">$02</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VKKEYSCANALTON</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-hex">$04</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">UNITNAME</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-str">'SendKeys'</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">UsingParens</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ShiftDown</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ControlDown</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">AltDown</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">FoundClose</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">PosSpace</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">I</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">L</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Integer</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">NumTimes</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">MKey</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">KeyString</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">String</span><span class="pas-sym">[</span><span class="pas-num">20</span><span class="pas-sym">]</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">DisplayMessage</span><span class="pas-sym">(</span><span class="pas-kwd">Message</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">MessageBox</span><span class="pas-sym">(</span><span class="pas-num">0</span><span class="pas-sym">,</span><span class="pas-kwd">Message</span><span class="pas-sym">,</span><span class="pas-ident">UNITNAME</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">function</span><span class="pas-space"> </span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">BitTable</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">BitMask</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">ByteBool</span><span class="pas-sym">(</span><span class="pas-ident">BitTable</span><span class="pas-space"> </span><span class="pas-kwd">and</span><span class="pas-space"> </span><span class="pas-ident">BitMask</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">SetBit</span><span class="pas-sym">(</span><span class="pas-kwd">var</span><span class="pas-space"> </span><span class="pas-ident">BitTable</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">BitMask</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">BitTable</span><span class="pas-sym">:=</span><span class="pas-ident">BitTable</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-ident">Bitmask</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Procedure</span><span class="pas-space"> </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">Flags</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Longint</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">KeyboardMsg</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">TMsg</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">keybd_event</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Flags</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Wait</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">While</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">PeekMessage</span><span class="pas-sym">(</span><span class="pas-ident">KeyboardMsg</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">,</span><span class="pas-ident">WM_KEYFIRST</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WM_KEYLAST</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">PM_REMOVE</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">do</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">TranslateMessage</span><span class="pas-sym">(</span><span class="pas-ident">KeyboardMsg</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">DispatchMessage</span><span class="pas-sym">(</span><span class="pas-ident">KeyboardMsg</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Procedure</span><span class="pas-space"> </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">NumTimes</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">GenUpMsg</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Cnt</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ScanCode</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">NumState</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">KeyBoardState</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">TKeyboardState</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">if</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">=</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">NumState</span><span class="pas-sym">:=</span><span class="pas-ident">ByteBool</span><span class="pas-sym">(</span><span class="pas-ident">GetKeyState</span><span class="pas-sym">(</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">and</span><span class="pas-space"> </span><span class="pas-num">1</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">GetKeyBoardState</span><span class="pas-sym">(</span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-ident">NumState</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">[</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">]</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">[</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">and</span><span class="pas-space"> </span><span class="pas-kwd">not</span><span class="pas-space"> </span><span class="pas-num">1</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">[</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">]</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">[</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-num">1</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SetKeyBoardState</span><span class="pas-sym">(</span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">Exit</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ScanCode</span><span class="pas-sym">:=</span><span class="pas-ident">Lo</span><span class="pas-sym">(</span><span class="pas-ident">MapVirtualKey</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">For</span><span class="pas-space"> </span><span class="pas-ident">Cnt</span><span class="pas-sym">:=</span><span class="pas-num">1</span><span class="pas-space"> </span><span class="pas-kwd">to</span><span class="pas-space"> </span><span class="pas-ident">NumTimes</span><span class="pas-space"> </span><span class="pas-kwd">do</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-space"> </span><span class="pas-kwd">in</span><span class="pas-space"> </span><span class="pas-ident">ExtendedVKeys</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_EXTENDEDKEY</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">GenUpMsg</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_EXTENDEDKEY</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_KEYUP</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">GenUpMsg</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_KEYUP</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Procedure</span><span class="pas-space"> </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ScanCode</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ScanCode</span><span class="pas-sym">:=</span><span class="pas-ident">Lo</span><span class="pas-sym">(</span><span class="pas-ident">MapVirtualKey</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-space"> </span><span class="pas-kwd">in</span><span class="pas-space"> </span><span class="pas-ident">ExtendedVKeys</span><span class="pas-sym">)</span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_EXTENDEDKEY</span><span class="pas-space"> </span><span class="pas-kwd">and</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_KEYUP</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_KEYUP</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Procedure</span><span class="pas-space"> </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">NumTimes</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">GenDownMsg</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_SHIFT</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANCTRLON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_CONTROL</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANALTON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_MENU</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">Lo</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">NumTimes</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">GenDownMsg</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_SHIFT</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANCTRLON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_CONTROL</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANALTON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_MENU</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">{Implements a simple binary search to locate special key name strings}</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Function</span><span class="pas-space"> </span><span class="pas-ident">StringToVKey</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">ShortString</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Found</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Collided</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Bottom</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Top</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Middle</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">INVALIDKEY</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Bottom</span><span class="pas-sym">:=</span><span class="pas-num">1</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Top</span><span class="pas-sym">:=</span><span class="pas-ident">MaxSendKeyRecs</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Found</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Middle</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-ident">Bottom</span><span class="pas-sym">+</span><span class="pas-ident">Top</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">div</span><span class="pas-space"> </span><span class="pas-num">2</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">Repeat</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">Collided</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-sym">(</span><span class="pas-ident">Bottom</span><span class="pas-sym">=</span><span class="pas-ident">Middle</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Top</span><span class="pas-sym">=</span><span class="pas-ident">Middle</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">=</span><span class="pas-ident">SendKeyRecs</span><span class="pas-sym">[</span><span class="pas-ident">Middle</span><span class="pas-sym">]</span><span class="pas-sym">.</span><span class="pas-ident">Name</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-ident">Found</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">SendKeyRecs</span><span class="pas-sym">[</span><span class="pas-ident">Middle</span><span class="pas-sym">]</span><span class="pas-sym">.</span><span class="pas-ident">VKey</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">&gt;</span><span class="pas-ident">SendKeyRecs</span><span class="pas-sym">[</span><span class="pas-ident">Middle</span><span class="pas-sym">]</span><span class="pas-sym">.</span><span class="pas-ident">Name</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">Bottom</span><span class="pas-sym">:=</span><span class="pas-ident">Middle</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">Top</span><span class="pas-sym">:=</span><span class="pas-ident">Middle</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-ident">Middle</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-ident">Succ</span><span class="pas-sym">(</span><span class="pas-ident">Bottom</span><span class="pas-sym">+</span><span class="pas-ident">Top</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">div</span><span class="pas-space"> </span><span class="pas-num">2</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">Until</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Found</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-ident">Collided</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Result</span><span class="pas-sym">=</span><span class="pas-ident">INVALIDKEY</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">DisplayMessage</span><span class="pas-sym">(</span><span class="pas-str">'Invalid Key Name'</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-kwd">not</span><span class="pas-space"> </span><span class="pas-ident">UsingParens</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-ident">ShiftDown</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_SHIFT</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-ident">ControlDown</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_CONTROL</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-ident">AltDown</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_MENU</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">ShiftDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">ControlDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">AltDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">AllocationSize</span><span class="pas-sym">:=</span><span class="pas-ident">MaxInt</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">UsingParens</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ShiftDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ControlDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">AltDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">I</span><span class="pas-sym">:=</span><span class="pas-num">0</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">L</span><span class="pas-sym">:=</span><span class="pas-ident">StrLen</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">L</span><span class="pas-sym">&gt;</span><span class="pas-ident">AllocationSize</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">L</span><span class="pas-sym">:=</span><span class="pas-ident">AllocationSize</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">L</span><span class="pas-sym">=</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">Exit</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">While</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">&lt;</span><span class="pas-ident">L</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">do</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">case</span><span class="pas-space"> </span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'('</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">UsingParens</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">')'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">UsingParens</span><span class="pas-sym">:=</span><span class="pas-ident">False</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'%'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">AltDown</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_MENU</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'+'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">ShiftDown</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_SHIFT</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">           </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'^'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">ControlDown</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_CONTROL</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">           </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'{'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">NumTimes</span><span class="pas-sym">:=</span><span class="pas-num">1</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">Succ</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">]</span><span class="pas-sym">=</span><span class="pas-str">'{'</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">VK_LEFTBRACKET</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SetBit</span><span class="pas-sym">(</span><span class="pas-ident">Wbytes</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">[</span><span class="pas-num">1</span><span class="pas-sym">]</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">,</span><span class="pas-num">3</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Continue</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">KeyString</span><span class="pas-sym">:=</span><span class="pas-str">''</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">FoundClose</span><span class="pas-sym">:=</span><span class="pas-ident">False</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">While</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">&lt;=</span><span class="pas-ident">L</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">do</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-sym">=</span><span class="pas-str">'}'</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">                </span><span class="pas-ident">FoundClose</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">                </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">                </span><span class="pas-ident">Break</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">KeyString</span><span class="pas-sym">:=</span><span class="pas-ident">KeyString</span><span class="pas-sym">+</span><span class="pas-ident">Upcase</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-kwd">Not</span><span class="pas-space"> </span><span class="pas-ident">FoundClose</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">DisplayMessage</span><span class="pas-sym">(</span><span class="pas-str">'No Close'</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Exit</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-sym">=</span><span class="pas-str">'}'</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">VK_RIGHTBRACKET</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SetBit</span><span class="pas-sym">(</span><span class="pas-ident">Wbytes</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">[</span><span class="pas-num">1</span><span class="pas-sym">]</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Continue</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">PosSpace</span><span class="pas-sym">:=</span><span class="pas-ident">Pos</span><span class="pas-sym">(</span><span class="pas-str">' '</span><span class="pas-sym">,</span><span class="pas-ident">KeyString</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">PosSpace</span><span class="pas-sym">&lt;&gt;</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">NumTimes</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-ident">StrToInt</span><span class="pas-sym">(</span></pre>
<pre class="line"><span class="pas-space">                </span><span class="pas-ident">Copy</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">,</span><span class="pas-ident">Succ</span><span class="pas-sym">(</span><span class="pas-ident">PosSpace</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">Length</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">)</span><span class="pas-sym">-</span><span class="pas-ident">PosSpace</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">KeyString</span><span class="pas-sym">:=</span><span class="pas-ident">Copy</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">Pred</span><span class="pas-sym">(</span><span class="pas-ident">PosSpace</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Length</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">)</span><span class="pas-sym">=</span><span class="pas-num">1</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">vkKeyScan</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">[</span><span class="pas-num">1</span><span class="pas-sym">]</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">StringToVKey</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">&lt;&gt;</span><span class="pas-ident">INVALIDKEY</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">,</span><span class="pas-ident">NumTimes</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Continue</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'~'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_RETURN</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">vkKeyScan</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-kwd">if</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">&lt;&gt;</span><span class="pas-ident">INVALIDKEY</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-kwd">end</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-ident">DisplayMessage</span><span class="pas-sym">(</span><span class="pas-str">'Invalid KeyName'</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">true</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">{AppActivate</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">This is used to set the current input focus to a given window using its</span></pre>
<pre class="line"><span class="pas-comment">name.  This is especially useful for ensuring a window is active before</span></pre>
<pre class="line"><span class="pas-comment">sending it input messages using the SendKeys function.  You can specify</span></pre>
<pre class="line"><span class="pas-comment">a window's name in its entirety, or only portion of it, beginning from</span></pre>
<pre class="line"><span class="pas-comment">the left.}</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WindowHandle</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">HWND</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">function</span><span class="pas-space"> </span><span class="pas-ident">EnumWindowsProc</span><span class="pas-sym">(</span><span class="pas-ident">WHandle</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">HWND</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">lParam</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">LPARAM</span><span class="pas-sym">)</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">BOOL</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">export</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">stdcall</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WindowName</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">0</span><span class="pas-sym">..</span><span class="pas-ident">MAX_PATH</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">char</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-comment">{Can't test GetWindowText's return value since some windows don't have a</span></pre>
<pre class="line"><span class="pas-comment">  title}</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">GetWindowText</span><span class="pas-sym">(</span><span class="pas-ident">WHandle</span><span class="pas-sym">,</span><span class="pas-ident">WindowName</span><span class="pas-sym">,</span><span class="pas-ident">MAX_PATH</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">StrLIComp</span><span class="pas-sym">(</span><span class="pas-ident">WindowName</span><span class="pas-sym">,</span><span class="pas-ident">PChar</span><span class="pas-sym">(</span><span class="pas-ident">lParam</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">StrLen</span><span class="pas-sym">(</span><span class="pas-ident">PChar</span><span class="pas-sym">(</span><span class="pas-ident">lParam</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">&lt;&gt;</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-kwd">not</span><span class="pas-space"> </span><span class="pas-ident">Result</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">WindowHandle</span><span class="pas-sym">:=</span><span class="pas-ident">WHandle</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">function</span><span class="pas-space"> </span><span class="pas-ident">AppActivate</span><span class="pas-sym">(</span><span class="pas-ident">WindowName</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">try</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">true</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">WindowHandle</span><span class="pas-sym">:=</span><span class="pas-ident">FindWindow</span><span class="pas-sym">(</span><span class="pas-kwd">nil</span><span class="pas-sym">,</span><span class="pas-ident">WindowName</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">=</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">EnumWindows</span><span class="pas-sym">(</span><span class="pas-sym">@</span><span class="pas-ident">EnumWindowsProc</span><span class="pas-sym">,</span><span class="pas-ident">Integer</span><span class="pas-sym">(</span><span class="pas-ident">PChar</span><span class="pas-sym">(</span><span class="pas-ident">WindowName</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">&lt;&gt;</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">SendMessage</span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WM_SYSCOMMAND</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">SC_HOTKEY</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WindowHandle</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">SendMessage</span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WM_SYSCOMMAND</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">SC_RESTORE</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WindowHandle</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">SetForegroundWindow</span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">except</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">on</span><span class="pas-space"> </span><span class="pas-ident">Exception</span><span class="pas-space"> </span><span class="pas-kwd">do</span><span class="pas-space"> </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">.</span></pre>
</div>
</div>

<p class="credits">
  This tip, including the source code, is copyright &copy; 1995, Ken Henderson.
</p>

<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Ken Henderson</td>
  </tr>
  <tr>
    <th scope="row">Contributor:</th>
    <td>Irfan Karazor</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2012-07-05</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2012-07-05</td>
  </tr>
</table>

<div class="search noprint">
<form name="tipsSearchForm" id="tipsSearchForm" method="post" action="/tips">
<input class="text" type="text" name="txtSearch" id="txtSearch" value="" size="24" maxlength="80" />
<input class="button" type="submit" name="btnSearch" id="btnSearch" value="Search" />
</form>
</div>
<ul class="tip-nav noprint">
<li><a href="/tips/1">First</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/177">177</a></li>
<li><a href="/tips/178">178</a></li>
<li><a href="/tips/179">179</a></li>
<li><a href="/tips/180">180</a></li>
<li><span class="current">181</span></li>
<li><a href="/tips/182">182</a></li>
<li><a href="/tips/183">183</a></li>
<li><a href="/tips/184">184</a></li>
<li><a href="/tips/185">185</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/234">Last</a></li>
</ul>

<p class="centre-align noprint">
  &laquo; <a href="/tips">Return to contents</a> &raquo;
</p>

</div> <!-- #content -->
</div> <!-- #main -->
<div id="footer">
<div class="hide-from-css"><hr /></div> <!-- .hide-from-css -->
<a href="/copyright">Copyright</a> &copy; Peter Johnson (<a href="/background">DelphiDabbler</a>) 2002-2020</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
