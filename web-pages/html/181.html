<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Simulate the Visual Basic SendKeys and AppActivate routines in Delphi</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="Simulate the Visual Basic SendKeys and AppActivate routines in Delphi" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="stylesheet" href="../css/main.css" />
<link rel="stylesheet" href="../css/main-multicol-scr.css" media="screen" />
<link rel="stylesheet" href="../css/main-2col-scr.css" media="screen" />
<script type="text/javascript" src="../js/core.js"></script>
<script type="text/javascript" src="../js/offsite-win.js"></script>
<link rel="stylesheet" href="../css/tips.css" />
<link rel="stylesheet" href="../css/source.css" />
</head>
<body>
<div id="wrapper">

<h1>
	Simulate the Visual Basic SendKeys and AppActivate routines in Delphi
</h1>

<p>
  This unit includes two routines that simulate popular Visual Basic routines:
  <var>Sendkeys</var> and <var>AppActivate</var>.  <var>SendKeys</var> takes
  <var>PChar</var> as its first parameter and a <var>Boolean</var> as its second,
  like so:
</p>

<div class="indent">
<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasHi -->
<div class="pas-source">
<pre class="line"><span class="pas-ident">SendKeys</span><span class="pas-sym">(</span><span class="pas-str">'KeyString'</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Wait</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
</div>
</div>
</div>

<p>
  where <var>KeyString</var> is a string of key names and modifiers that you
  want to send to the current input focus and <var>Wait</var> is a Boolean
  variable or value that indicates whether <var>SendKeys</var> should wait for
  each key message to be processed before proceeding. See the table below for
  more information.
</p>

<p>
  <var>AppActivate</var> also takes a <var>PChar</var> as its only parameter,
  like so:
</p>

<div class="indent">
<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasHi -->
<div class="pas-source">
<pre class="line"><span class="pas-ident">AppActivate</span><span class="pas-sym">(</span><span class="pas-str">'WindowName'</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
</div>
</div>
</div>

<p>
  where <var>WindowName</var> is the name of the window that you want to make
  the current input focus.
</p>

<p>
  <var>SendKeys</var> supports the Visual Basic <var>SendKeys</var> syntax, as
  documented below.
</p>

<div class="frame">
  <table>
    <caption>Supported modifiers</caption>
    <tr>
      <td style="width:10%;">+</td>
      <td>Shift</td>
    </tr>
    <tr>
      <td>^</td>
      <td>Control</td>
    </tr>
    <tr>
      <td>%</td>
      <td>Alt</td>
    </tr>
  </table>
</div>

<p>
  Surround sequences of characters or key names with parentheses in order to
  modify them as a group.  For example, '+abc' shifts only 'a', while '+(abc)'
  shifts all three characters.
</p>

<div class="frame">
  <table>
    <caption>Supported special characters</caption>
    <tr>
      <td style="width:10%;">~</td>
      <td>Enter</td>
    </tr>
    <tr>
      <td>(</td>
      <td>Begin modifier group (see above)</td>
    </tr>
    <tr>
      <td>)</td>
      <td>End modifier group (see above)</td>
    </tr>
    <tr>
      <td>{</td>
      <td>Begin key name text (see below)</td>
    </tr>
    <tr>
      <td>}</td>
      <td>End key name text (see below)</td>
    </tr>
  </table>
</div>

<p>
  Any character that can be typed is supported. Surround the modifier keys
  listed above with braces in order to send as normal text.
</p>

<p>
  Supported key names (surround these with braces):
</p>

<p class="indent">
  <code>BKSP, BS, BACKSPACE<br />
  BREAK<br />
  CAPSLOCK<br />
  CLEAR<br />
  DEL<br />
  DELETE<br />
  DOWN<br />
  END<br />
  ENTER<br />
  ESC<br />
  ESCAPE<br />
  F1<br />
  F2<br />
  F3<br />
  F4<br />
  F5<br />
  F6<br />
  F7<br />
  F8<br />
  F9<br />
  F10<br />
  F11<br />
  F12<br />
  F13<br />
  F14<br />
  F15<br />
  F16<br />
  HELP<br />
  HOME<br />
  INS<br />
  LEFT<br />
  NUMLOCK<br />
  PGDN<br />
  PGUP<br />
  PRTSC<br />
  RIGHT<br />
  SCROLLLOCK<br />
  TAB<br />
  UP<br /></code>
</p>

<p>
  Follow the keyname with a space and a number to send the specified key a given
  number of times (e.g., {left 6}).
</p>

<p>
  Here's the unit.
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasHi -->
<div class="pas-source">
<pre class="line"><span class="pas-kwd">unit</span><span class="pas-space"> </span><span class="pas-ident">sndkey32</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">interface</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Uses</span><span class="pas-space"> </span><span class="pas-ident">SysUtils</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Windows</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Messages</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Function</span><span class="pas-space"> </span><span class="pas-ident">SendKeys</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">Wait</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">function</span><span class="pas-space"> </span><span class="pas-ident">AppActivate</span><span class="pas-sym">(</span><span class="pas-ident">WindowName</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">{Buffer for working with PChar's}</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">const</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WorkBufLen</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-num">40</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WorkBuf</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">0</span><span class="pas-sym">..</span><span class="pas-ident">WorkBufLen</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">Char</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">implementation</span></pre>
<pre class="line"><span class="pas-kwd">type</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">THKeys</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">0</span><span class="pas-sym">..</span><span class="pas-ident">pred</span><span class="pas-sym">(</span><span class="pas-ident">MaxLongInt</span><span class="pas-sym">)</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">AllocationSize</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">integer</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">(*</span></pre>
<pre class="line"><span class="pas-comment">Converts a string of characters and key names to keyboard events and</span></pre>
<pre class="line"><span class="pas-comment">passes them to Windows.</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">Example syntax:</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">SendKeys('abc123{left}{left}{left}def{end}456{left 6}ghi{end}789', True);</span></pre>
<pre class="line"><span class="pas-comment">*)</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Function</span><span class="pas-space"> </span><span class="pas-ident">SendKeys</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">Wait</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">type</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WBytes</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">0</span><span class="pas-sym">..</span><span class="pas-ident">pred</span><span class="pas-sym">(</span><span class="pas-ident">SizeOf</span><span class="pas-sym">(</span><span class="pas-ident">Word</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">TSendKey</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-kwd">record</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">Name</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">ShortString</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">VKey</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">const</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-comment">{Array of keys that SendKeys recognizes.</span></pre>
<pre class="line"><span class="pas-comment">  If you add to this list, you must be sure to keep it sorted alphabetically</span></pre>
<pre class="line"><span class="pas-comment">  by Name because a binary search routine is used to scan it.}</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">MaxSendKeyRecs</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-num">41</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">SendKeyRecs</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">1</span><span class="pas-sym">..</span><span class="pas-ident">MaxSendKeyRecs</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">TSendKey</span><span class="pas-space"> </span><span class="pas-sym">=</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-sym">(</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'BACKSPACE'</span><span class="pas-sym">;</span><span class="pas-space">       </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_BACK</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'BKSP'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_BACK</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'BREAK'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_CANCEL</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'BS'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_BACK</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'CAPSLOCK'</span><span class="pas-sym">;</span><span class="pas-space">        </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_CAPITAL</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'CLEAR'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_CLEAR</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'DEL'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_DELETE</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'DELETE'</span><span class="pas-sym">;</span><span class="pas-space">          </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_DELETE</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'DOWN'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_DOWN</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'END'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_END</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'ENTER'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_RETURN</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'ESC'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_ESCAPE</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'ESCAPE'</span><span class="pas-sym">;</span><span class="pas-space">          </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_ESCAPE</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F1'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F1</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F10'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F10</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F11'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F11</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F12'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F12</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F13'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F13</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F14'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F14</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F15'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F15</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F16'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F16</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F2'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F2</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F3'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F3</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F4'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F4</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F5'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F5</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F6'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F6</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F7'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F7</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F8'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F8</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'F9'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_F9</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'HELP'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_HELP</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'HOME'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_HOME</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'INS'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_INSERT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'LEFT'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_LEFT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'NUMLOCK'</span><span class="pas-sym">;</span><span class="pas-space">         </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'PGDN'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_NEXT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'PGUP'</span><span class="pas-sym">;</span><span class="pas-space">            </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_PRIOR</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'PRTSC'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_PRINT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'RIGHT'</span><span class="pas-sym">;</span><span class="pas-space">           </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_RIGHT</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'SCROLLLOCK'</span><span class="pas-sym">;</span><span class="pas-space">      </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_SCROLL</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'TAB'</span><span class="pas-sym">;</span><span class="pas-space">             </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_TAB</span><span class="pas-sym">)</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-sym">(</span><span class="pas-ident">Name</span><span class="pas-sym">:</span><span class="pas-str">'UP'</span><span class="pas-sym">;</span><span class="pas-space">              </span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-ident">VK_UP</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-comment">{Extra VK constants missing from Delphi's Windows API interface}</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_NULL</span><span class="pas-sym">=</span><span class="pas-num">0</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_SemiColon</span><span class="pas-sym">=</span><span class="pas-num">186</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Equal</span><span class="pas-sym">=</span><span class="pas-num">187</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Comma</span><span class="pas-sym">=</span><span class="pas-num">188</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Minus</span><span class="pas-sym">=</span><span class="pas-num">189</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Period</span><span class="pas-sym">=</span><span class="pas-num">190</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Slash</span><span class="pas-sym">=</span><span class="pas-num">191</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_BackQuote</span><span class="pas-sym">=</span><span class="pas-num">192</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_LeftBracket</span><span class="pas-sym">=</span><span class="pas-num">219</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_BackSlash</span><span class="pas-sym">=</span><span class="pas-num">220</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_RightBracket</span><span class="pas-sym">=</span><span class="pas-num">221</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Quote</span><span class="pas-sym">=</span><span class="pas-num">222</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VK_Last</span><span class="pas-sym">=</span><span class="pas-ident">VK_Quote</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ExtendedVKeys</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">set</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">byte</span><span class="pas-space"> </span><span class="pas-sym">=</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-sym">[</span><span class="pas-ident">VK_Up</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Down</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Left</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Right</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Home</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_End</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Prior</span><span class="pas-sym">,</span><span class="pas-space">  </span><span class="pas-comment">{PgUp}</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Next</span><span class="pas-sym">,</span><span class="pas-space">   </span><span class="pas-comment">{PgDn}</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Insert</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">   </span><span class="pas-ident">VK_Delete</span><span class="pas-sym">]</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">const</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">INVALIDKEY</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-hex">$FFFF</span><span class="pas-space"> </span><span class="pas-comment">{Unsigned -1}</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-hex">$01</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VKKEYSCANCTRLON</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-hex">$02</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">VKKEYSCANALTON</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-hex">$04</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">UNITNAME</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-str">'SendKeys'</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">UsingParens</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ShiftDown</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ControlDown</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">AltDown</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">FoundClose</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">PosSpace</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">I</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">L</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Integer</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">NumTimes</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">MKey</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">KeyString</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">String</span><span class="pas-sym">[</span><span class="pas-num">20</span><span class="pas-sym">]</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">DisplayMessage</span><span class="pas-sym">(</span><span class="pas-kwd">Message</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">MessageBox</span><span class="pas-sym">(</span><span class="pas-num">0</span><span class="pas-sym">,</span><span class="pas-kwd">Message</span><span class="pas-sym">,</span><span class="pas-ident">UNITNAME</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">function</span><span class="pas-space"> </span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">BitTable</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">BitMask</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">ByteBool</span><span class="pas-sym">(</span><span class="pas-ident">BitTable</span><span class="pas-space"> </span><span class="pas-kwd">and</span><span class="pas-space"> </span><span class="pas-ident">BitMask</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">SetBit</span><span class="pas-sym">(</span><span class="pas-kwd">var</span><span class="pas-space"> </span><span class="pas-ident">BitTable</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">BitMask</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">BitTable</span><span class="pas-sym">:=</span><span class="pas-ident">BitTable</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-ident">Bitmask</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Procedure</span><span class="pas-space"> </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">Flags</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Longint</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">KeyboardMsg</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">TMsg</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">keybd_event</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Flags</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Wait</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">While</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">PeekMessage</span><span class="pas-sym">(</span><span class="pas-ident">KeyboardMsg</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">,</span><span class="pas-ident">WM_KEYFIRST</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WM_KEYLAST</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">PM_REMOVE</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">do</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">TranslateMessage</span><span class="pas-sym">(</span><span class="pas-ident">KeyboardMsg</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">DispatchMessage</span><span class="pas-sym">(</span><span class="pas-ident">KeyboardMsg</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Procedure</span><span class="pas-space"> </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">NumTimes</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">GenUpMsg</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Cnt</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ScanCode</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">NumState</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">KeyBoardState</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">TKeyboardState</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">if</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">=</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">NumState</span><span class="pas-sym">:=</span><span class="pas-ident">ByteBool</span><span class="pas-sym">(</span><span class="pas-ident">GetKeyState</span><span class="pas-sym">(</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">and</span><span class="pas-space"> </span><span class="pas-num">1</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">GetKeyBoardState</span><span class="pas-sym">(</span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-ident">NumState</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">[</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">]</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">[</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">and</span><span class="pas-space"> </span><span class="pas-kwd">not</span><span class="pas-space"> </span><span class="pas-num">1</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">[</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">]</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">[</span><span class="pas-ident">VK_NUMLOCK</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-num">1</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SetKeyBoardState</span><span class="pas-sym">(</span><span class="pas-ident">KeyBoardState</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">Exit</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ScanCode</span><span class="pas-sym">:=</span><span class="pas-ident">Lo</span><span class="pas-sym">(</span><span class="pas-ident">MapVirtualKey</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">For</span><span class="pas-space"> </span><span class="pas-ident">Cnt</span><span class="pas-sym">:=</span><span class="pas-num">1</span><span class="pas-space"> </span><span class="pas-kwd">to</span><span class="pas-space"> </span><span class="pas-ident">NumTimes</span><span class="pas-space"> </span><span class="pas-kwd">do</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-space"> </span><span class="pas-kwd">in</span><span class="pas-space"> </span><span class="pas-ident">ExtendedVKeys</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_EXTENDEDKEY</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">GenUpMsg</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_EXTENDEDKEY</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_KEYUP</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">GenUpMsg</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_KEYUP</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Procedure</span><span class="pas-space"> </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ScanCode</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ScanCode</span><span class="pas-sym">:=</span><span class="pas-ident">Lo</span><span class="pas-sym">(</span><span class="pas-ident">MapVirtualKey</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-space"> </span><span class="pas-kwd">in</span><span class="pas-space"> </span><span class="pas-ident">ExtendedVKeys</span><span class="pas-sym">)</span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_EXTENDEDKEY</span><span class="pas-space"> </span><span class="pas-kwd">and</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_KEYUP</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">KeyboardEvent</span><span class="pas-sym">(</span><span class="pas-ident">VKey</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">ScanCode</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">KEYEVENTF_KEYUP</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Procedure</span><span class="pas-space"> </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">NumTimes</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">GenDownMsg</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_SHIFT</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANCTRLON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_CONTROL</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANALTON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_MENU</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">Lo</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">NumTimes</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">GenDownMsg</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_SHIFT</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANCTRLON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_CONTROL</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">BitSet</span><span class="pas-sym">(</span><span class="pas-ident">Hi</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANALTON</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_MENU</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">{Implements a simple binary search to locate special key name strings}</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">Function</span><span class="pas-space"> </span><span class="pas-ident">StringToVKey</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">ShortString</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Word</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Found</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Collided</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Bottom</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Top</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Middle</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">Byte</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">INVALIDKEY</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Bottom</span><span class="pas-sym">:=</span><span class="pas-num">1</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Top</span><span class="pas-sym">:=</span><span class="pas-ident">MaxSendKeyRecs</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Found</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Middle</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-ident">Bottom</span><span class="pas-sym">+</span><span class="pas-ident">Top</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">div</span><span class="pas-space"> </span><span class="pas-num">2</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">Repeat</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">Collided</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-sym">(</span><span class="pas-ident">Bottom</span><span class="pas-sym">=</span><span class="pas-ident">Middle</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Top</span><span class="pas-sym">=</span><span class="pas-ident">Middle</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">=</span><span class="pas-ident">SendKeyRecs</span><span class="pas-sym">[</span><span class="pas-ident">Middle</span><span class="pas-sym">]</span><span class="pas-sym">.</span><span class="pas-ident">Name</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-ident">Found</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">SendKeyRecs</span><span class="pas-sym">[</span><span class="pas-ident">Middle</span><span class="pas-sym">]</span><span class="pas-sym">.</span><span class="pas-ident">VKey</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">&gt;</span><span class="pas-ident">SendKeyRecs</span><span class="pas-sym">[</span><span class="pas-ident">Middle</span><span class="pas-sym">]</span><span class="pas-sym">.</span><span class="pas-ident">Name</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">Bottom</span><span class="pas-sym">:=</span><span class="pas-ident">Middle</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">Top</span><span class="pas-sym">:=</span><span class="pas-ident">Middle</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">       </span><span class="pas-ident">Middle</span><span class="pas-sym">:=</span><span class="pas-sym">(</span><span class="pas-ident">Succ</span><span class="pas-sym">(</span><span class="pas-ident">Bottom</span><span class="pas-sym">+</span><span class="pas-ident">Top</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">div</span><span class="pas-space"> </span><span class="pas-num">2</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">Until</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Found</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-ident">Collided</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Result</span><span class="pas-sym">=</span><span class="pas-ident">INVALIDKEY</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">DisplayMessage</span><span class="pas-sym">(</span><span class="pas-str">'Invalid Key Name'</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-kwd">not</span><span class="pas-space"> </span><span class="pas-ident">UsingParens</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-ident">ShiftDown</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_SHIFT</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-ident">ControlDown</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_CONTROL</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-ident">AltDown</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">SendKeyUp</span><span class="pas-sym">(</span><span class="pas-ident">VK_MENU</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">ShiftDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">ControlDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">AltDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">AllocationSize</span><span class="pas-sym">:=</span><span class="pas-ident">MaxInt</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">UsingParens</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ShiftDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">ControlDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">AltDown</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">I</span><span class="pas-sym">:=</span><span class="pas-num">0</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">L</span><span class="pas-sym">:=</span><span class="pas-ident">StrLen</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">L</span><span class="pas-sym">&gt;</span><span class="pas-ident">AllocationSize</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">L</span><span class="pas-sym">:=</span><span class="pas-ident">AllocationSize</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">L</span><span class="pas-sym">=</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span><span class="pas-space"> </span><span class="pas-ident">Exit</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">While</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">&lt;</span><span class="pas-ident">L</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">do</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">case</span><span class="pas-space"> </span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'('</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">UsingParens</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">')'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">UsingParens</span><span class="pas-sym">:=</span><span class="pas-ident">False</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'%'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">AltDown</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_MENU</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'+'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">ShiftDown</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_SHIFT</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">           </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'^'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space">  </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">ControlDown</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_CONTROL</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">False</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">             </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">           </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'{'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">NumTimes</span><span class="pas-sym">:=</span><span class="pas-num">1</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">Succ</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">]</span><span class="pas-sym">=</span><span class="pas-str">'{'</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">VK_LEFTBRACKET</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SetBit</span><span class="pas-sym">(</span><span class="pas-ident">Wbytes</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">[</span><span class="pas-num">1</span><span class="pas-sym">]</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">,</span><span class="pas-num">3</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Continue</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">KeyString</span><span class="pas-sym">:=</span><span class="pas-str">''</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">FoundClose</span><span class="pas-sym">:=</span><span class="pas-ident">False</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">While</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">&lt;=</span><span class="pas-ident">L</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">do</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-sym">=</span><span class="pas-str">'}'</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">                </span><span class="pas-ident">FoundClose</span><span class="pas-sym">:=</span><span class="pas-ident">True</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">                </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">                </span><span class="pas-ident">Break</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">KeyString</span><span class="pas-sym">:=</span><span class="pas-ident">KeyString</span><span class="pas-sym">+</span><span class="pas-ident">Upcase</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-kwd">Not</span><span class="pas-space"> </span><span class="pas-ident">FoundClose</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">DisplayMessage</span><span class="pas-sym">(</span><span class="pas-str">'No Close'</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Exit</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-sym">=</span><span class="pas-str">'}'</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">VK_RIGHTBRACKET</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SetBit</span><span class="pas-sym">(</span><span class="pas-ident">Wbytes</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">)</span><span class="pas-sym">[</span><span class="pas-num">1</span><span class="pas-sym">]</span><span class="pas-sym">,</span><span class="pas-ident">VKKEYSCANSHIFTON</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Continue</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">PosSpace</span><span class="pas-sym">:=</span><span class="pas-ident">Pos</span><span class="pas-sym">(</span><span class="pas-str">' '</span><span class="pas-sym">,</span><span class="pas-ident">KeyString</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">PosSpace</span><span class="pas-sym">&lt;&gt;</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">NumTimes</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-ident">StrToInt</span><span class="pas-sym">(</span></pre>
<pre class="line"><span class="pas-space">                </span><span class="pas-ident">Copy</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">,</span><span class="pas-ident">Succ</span><span class="pas-sym">(</span><span class="pas-ident">PosSpace</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-ident">Length</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">)</span><span class="pas-sym">-</span><span class="pas-ident">PosSpace</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">KeyString</span><span class="pas-sym">:=</span><span class="pas-ident">Copy</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">Pred</span><span class="pas-sym">(</span><span class="pas-ident">PosSpace</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">Length</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">)</span><span class="pas-sym">=</span><span class="pas-num">1</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">vkKeyScan</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">[</span><span class="pas-num">1</span><span class="pas-sym">]</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">StringToVKey</span><span class="pas-sym">(</span><span class="pas-ident">KeyString</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">&lt;&gt;</span><span class="pas-ident">INVALIDKEY</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">,</span><span class="pas-ident">NumTimes</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">              </span><span class="pas-ident">Continue</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-str">'~'</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">SendKeyDown</span><span class="pas-sym">(</span><span class="pas-ident">VK_RETURN</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">            </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">MKey</span><span class="pas-sym">:=</span><span class="pas-ident">vkKeyScan</span><span class="pas-sym">(</span><span class="pas-ident">SendKeysString</span><span class="pas-sym">[</span><span class="pas-ident">I</span><span class="pas-sym">]</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-kwd">if</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">&lt;&gt;</span><span class="pas-ident">INVALIDKEY</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-ident">SendKey</span><span class="pas-sym">(</span><span class="pas-ident">MKey</span><span class="pas-sym">,</span><span class="pas-num">1</span><span class="pas-sym">,</span><span class="pas-ident">True</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-kwd">end</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">          </span><span class="pas-ident">DisplayMessage</span><span class="pas-sym">(</span><span class="pas-str">'Invalid KeyName'</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">        </span><span class="pas-ident">Inc</span><span class="pas-sym">(</span><span class="pas-ident">I</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">true</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">PopUpShiftKeys</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">{AppActivate</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">This is used to set the current input focus to a given window using its</span></pre>
<pre class="line"><span class="pas-comment">name.  This is especially useful for ensuring a window is active before</span></pre>
<pre class="line"><span class="pas-comment">sending it input messages using the SendKeys function.  You can specify</span></pre>
<pre class="line"><span class="pas-comment">a window's name in its entirety, or only portion of it, beginning from</span></pre>
<pre class="line"><span class="pas-comment">the left.}</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WindowHandle</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">HWND</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">function</span><span class="pas-space"> </span><span class="pas-ident">EnumWindowsProc</span><span class="pas-sym">(</span><span class="pas-ident">WHandle</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">HWND</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-ident">lParam</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">LPARAM</span><span class="pas-sym">)</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">BOOL</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">export</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">stdcall</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">var</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">WindowName</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-kwd">array</span><span class="pas-sym">[</span><span class="pas-num">0</span><span class="pas-sym">..</span><span class="pas-ident">MAX_PATH</span><span class="pas-sym">]</span><span class="pas-space"> </span><span class="pas-kwd">of</span><span class="pas-space"> </span><span class="pas-ident">char</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-comment">{Can't test GetWindowText's return value since some windows don't have a</span></pre>
<pre class="line"><span class="pas-comment">  title}</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">GetWindowText</span><span class="pas-sym">(</span><span class="pas-ident">WHandle</span><span class="pas-sym">,</span><span class="pas-ident">WindowName</span><span class="pas-sym">,</span><span class="pas-ident">MAX_PATH</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Result</span><span class="pas-space"> </span><span class="pas-sym">:=</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">StrLIComp</span><span class="pas-sym">(</span><span class="pas-ident">WindowName</span><span class="pas-sym">,</span><span class="pas-ident">PChar</span><span class="pas-sym">(</span><span class="pas-ident">lParam</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">StrLen</span><span class="pas-sym">(</span><span class="pas-ident">PChar</span><span class="pas-sym">(</span><span class="pas-ident">lParam</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">&lt;&gt;</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-kwd">not</span><span class="pas-space"> </span><span class="pas-ident">Result</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">WindowHandle</span><span class="pas-sym">:=</span><span class="pas-ident">WHandle</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">function</span><span class="pas-space"> </span><span class="pas-ident">AppActivate</span><span class="pas-sym">(</span><span class="pas-ident">WindowName</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">PChar</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">boolean</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">try</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">true</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-ident">WindowHandle</span><span class="pas-sym">:=</span><span class="pas-ident">FindWindow</span><span class="pas-sym">(</span><span class="pas-kwd">nil</span><span class="pas-sym">,</span><span class="pas-ident">WindowName</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">=</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">EnumWindows</span><span class="pas-sym">(</span><span class="pas-sym">@</span><span class="pas-ident">EnumWindowsProc</span><span class="pas-sym">,</span><span class="pas-ident">Integer</span><span class="pas-sym">(</span><span class="pas-ident">PChar</span><span class="pas-sym">(</span><span class="pas-ident">WindowName</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">If</span><span class="pas-space"> </span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">&lt;&gt;</span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-space"> </span><span class="pas-kwd">then</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">SendMessage</span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WM_SYSCOMMAND</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">SC_HOTKEY</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WindowHandle</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">SendMessage</span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WM_SYSCOMMAND</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">SC_RESTORE</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">WindowHandle</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">SetForegroundWindow</span><span class="pas-sym">(</span><span class="pas-ident">WindowHandle</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">end</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">else</span></pre>
<pre class="line"><span class="pas-space">      </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">except</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">on</span><span class="pas-space"> </span><span class="pas-ident">Exception</span><span class="pas-space"> </span><span class="pas-kwd">do</span><span class="pas-space"> </span><span class="pas-ident">Result</span><span class="pas-sym">:=</span><span class="pas-ident">false</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">.</span></pre>
</div>
</div>

<p class="credits">
  This tip, including the source code, is copyright &copy; 1995, Ken Henderson.
</p>

<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Ken Henderson</td>
  </tr>
  <tr>
    <th scope="row">Contributor:</th>
    <td>Irfan Karazor</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2012-07-05</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2012-07-05</td>
  </tr>
</table>



<div id="footer">
  Copyright &copy; Peter Johnson (<a href="https://gravatar.com/delphidabbler">DelphiDabbler</a>) 2002-2020
</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
