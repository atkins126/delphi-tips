<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Add animation effects to your forms</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="Add animation effects to your forms" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="canonical" href="http://delphidabbler.com/tips/188" />
<link rel="stylesheet" href="/css/main.css" />
<link rel="stylesheet" href="/css/main-multicol-scr.css" media="screen" />
<link rel="stylesheet" href="/css/main-2col-scr.css" media="screen" />
<script type="text/javascript" src="/js/core.js"></script>
<script type="text/javascript" src="/js/offsite-win.js"></script>
<link rel="stylesheet" href="/css/tips.css" />
<script type="text/javascript" src="/js/popup-win.js"></script>
<script type="text/javascript" src="/js/show-hide.js"></script>
<link rel="alternate" href="/feeds/site-news-feed?id=tips" type="application/rss+xml" title="DelphiDabbler.com Tips News" />
<link rel="stylesheet" href="/css/source.css" />
<link rel="stylesheet" href="/css/js-detect.css" />
<script type="text/javascript" src="/js/js-detect.js"></script>
<script type="text/javascript">
  function showDemo(linkId, demoId) {
    showHide(linkId, demoId, 'Show demo code', 'Hide demo code');
  }
</script>
<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<script type="text/javascript">
    window.cookieconsent_options = {"message":"This site uses cookies to deliver its services, to enable targeted advertising and to support various social media buttons, and to analyse traffic. By using this site, you agree to its use of cookies.","dismiss":"Got it!","learnMore":"More info","link":"http://delphidabbler.com/subsid/cookies","theme":"dark-top"};
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
<!-- End Cookie Consent plugin -->
</head>
<body>
<!-- Facebook script -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="wrapper">
<div id="header">
<div class="hide-from-css">
<h1>DelphiDabbler.com</h1>
<p>Open source software, Delphi components, Tutorials &amp; more.</p>
</div> <!-- .hide-from-css -->
<div id="header-right">
<div id="quicklink" style="padding-right:4px;">
&raquo; <a href="/sitemap">Sitemap</a></div>
</div>
</div> <!-- #header -->
<div class="noprint" style="padding: 0 .5em .5em .5em; margin: .5em; background-color: #fcc;">
  <h2 class="smallcaps centre-align">
    &laquo;&laquo; Site Rescued &raquo;&raquo;
  </h2>
  <p class="highlight">
    While the site is still going to move from its current host, a new site will now take its place. <strong><a href="https://delphidabbler.blogspot.com/2020/03/delphidabblercom-is-no-longer-closing.html">More Info</a></strong>.
  </p>
  <p>
    The new site may have less content, but the core will now remain. And it will now play nicely with phones! Keep an eye on the <a href="https://delphidabbler.blogspot.com/">DelphiDabbler Blog</a> for news.
  </p>
</div>
<div id="navigation">
<hr class="hide-from-css" />
<h2 class="hide-from-css">Navigation</h2>
<ul>
<li><a href="/index">Home&nbsp;Page</a></li>
<li><a href="/programs">Programs</a></li>
<li><a href="/codelib">Delphi&nbsp;Library</a></li>
<li><a href="/snips-n-tips">Snippets&nbsp;&amp;&nbsp;Tips</a>
<ul>
<li class="sub-item"><a href="http://snippets.delphidabbler.com/" class="offsite-no-glyph">Code Snippets (Take 2)</a></li>
<li class="sub-item"><a href="/tips" class="selected ">Delphi&nbsp;Tips</a></li>
<li class="sub-item"><a href="http://swag.delphidabbler.com/" class="offsite-no-glyph">SWAG&nbsp;Archive</a></li>
</ul>
</li>
<li><a href="/articles">Articles</a></li>
<li><a href="http://wiki.delphidabbler.com/" class="offsite-no-glyph">Documentation</a></li>
<li><a href="/blog">Blog</a></li>
<li><a href="/news">News</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/background">About</a></li>
</ul>
</div> <!-- #navigation -->
<div id="main">
<div id="content">
<span class="help noprint">&raquo <a href="/help/tips-help.html" class="js-popup">Help</a></span>
<h1>
	Add animation effects to your forms
</h1>

<div class="noprint">
<!-- style in following div and non-breaking spaces are a work around for a
     rendering bug in IE7 that sometimes hides preceeding h1 section if nothing
     is printed before this show_ads.js code is run.
     Tested and runs OK on Safari, Opera, Firefox, Chrome, but then, so did the
     original code! -->
<div class="centre-align" style="font-size:1pt;">&nbsp;
<script type="text/javascript"><!--
google_ad_client = "ca-pub-0907703677935617";
/* 468x60, created 11/04/09 */
google_ad_slot = "8060165044";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
&nbsp;
</div>
</div>
<p>
  The Windows GUI is full of graphical effects: roll, fade and popups make the
  interface attractive.
</p>

<p>
  If you want apply the same effects to your forms you need only one API
  function: <var>AnimateWindow</var>!
</p>

<p>
  This API is simple to use and you only supply the handle of your form, how
  long the animation should take in milliseconds and a bunch of flags to specify
  effects and directions.
</p>

</p>
  Try placing this code in the <var>OnShow</var> handler of your form:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasHi -->
<div class="pas-source">
<pre class="line"><span class="pas-sym">..</span><span class="pas-sym">.</span></pre>
<pre class="line"><span class="pas-ident">AnimateWindow</span><span class="pas-sym">(</span><span class="pas-ident">Self</span><span class="pas-sym">.</span><span class="pas-ident">Handle</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-num">250</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">AW_BLEND</span><span class="pas-space"> </span><span class="pas-kwd">or</span><span class="pas-space"> </span><span class="pas-ident">AW_ACTIVATE</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-sym">..</span><span class="pas-sym">.</span></pre>
</div>
</div>

<p>
  Run the project and see the result. Cool, it isn't?
</p>

<p>
  By default the function uses a roll effect, but you can change this using
  <var>AW_SLIDE</var> to obtain a slide effect, <var>AW_CENTER</var> to make the
  window collapse or expand or <var>AW_BLEND</var> to obtain a smooth fade
  effect.
</p>

<p>
  In addition you can add the <var>AW_ACTIVATE</var> flag to specify that the
  form is appearing or <var>AW_HIDE</var> if you're hiding your form; this flag
  reverses the direction of the animation.
</p>

<p>
  When you use the roll or slide you can specify the direction of the effects
  along the horizontal and verticale axis adding the <var>AW_HOR_POSITIVE</var>
  or <var>AW_HOR_NEGATIVE</var> for x-axis and <var>AW_VER_POSITIVE</var> or
  <var>AW_VER_NEGATIVE</var> for y-axis.
</p>

<p>
  All these flags are ignored when you use the <var>AW_CENTER</var> flag.
</p>

<p>
  Experiment various combinations of flags and see the results!
</p>

<p>
  After you've played for a while you will notice a quirk: some controls appears
  correctly, others are drawn erroneously and some other are not drawn at all!!
</p>

<p>
  My first thought was: &quot;Damn! It doesn't work&quot;. My second thought
  was: &quot;Why?&quot;
</p>

<p>
  Well the reason is quite simple but the solution is boring.
</p>

<p>
  The MSDN documentation states that the windows procedures for the controls on
  a form may need to handle the <var>WM_PRINT</var> or <var>WM_PRINTCLIENT</var>
  messages to be used in conjuction with the <var>AnimateWindow</var> API. Those
  messages are used when Windows needs to draw the contents of a control on a
  display context different from the screen (e.g. the printer or, as in our
  case, an offscreen bitmap). The documentation remarks that the window
  procedures for controls, common controls and dialog boxes already handle the
  messages.
</p>

<p>
  This explain why some controls are drawn correctly: <var>TButton</var>,
  <var>TCheckBox</var> and <var>TRadioButton</var>, for example, own and manage
  an underlying button control, therefore they handle messages correctly.
</p>

<p>
  The garbled controls are a middle species since they own a Windows control but
  some parts are drawn using the Delphi <var>TCanvas</var> and not the Windows
  GDI: <var>TEdit</var>, <var>TRichEdit</var> and others behave that way.
</p>

<p>
  The invisible controls are the ones who does not own a window ar all and are
  all the <var>TGraphic</var> descendants like <var>TShape</var> and
  <var>TBevel</var>: these controls will never be drawn because they will never
  get the necessary messages.
</p>

<p>
  Anyway, for every Delphi component descending from <var>TWinControl</var> you
  can intercept and handle the <var>WM_PRINTCLIENT</var> message in this way:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasHi -->
<div class="pas-source">
<pre class="line"><span class="pas-kwd">unit</span><span class="pas-space"> </span><span class="pas-ident">TestGroupBox</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">interface</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">uses</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">Windows</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Messages</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">SysUtils</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Classes</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Graphics</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Controls</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Forms</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-ident">Dialogs</span><span class="pas-sym">,</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">StdCtrls</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">type</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">TTestGroupBox</span><span class="pas-space"> </span><span class="pas-sym">=</span><span class="pas-space"> </span><span class="pas-kwd">class</span><span class="pas-sym">(</span><span class="pas-ident">TGroupBox</span><span class="pas-sym">)</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-kwd">protected</span></pre>
<pre class="line"><span class="pas-space">    </span><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">WMPrintClient</span><span class="pas-sym">(</span><span class="pas-kwd">var</span><span class="pas-space"> </span><span class="pas-ident">Msg</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">TMessage</span><span class="pas-sym">)</span><span class="pas-sym">;</span><span class="pas-space"> </span><span class="pas-kwd">message</span><span class="pas-space"> </span><span class="pas-ident">WM_PRINTCLIENT</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-space"> </span><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-kwd">Register</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">implementation</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-kwd">Register</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">RegisterComponents</span><span class="pas-sym">(</span><span class="pas-str">'Test'</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-sym">[</span><span class="pas-ident">TTestGroupBox</span><span class="pas-sym">]</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-comment">{ TTestGroupBox }</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">procedure</span><span class="pas-space"> </span><span class="pas-ident">TTestGroupBox</span><span class="pas-sym">.</span><span class="pas-ident">WMPrintClient</span><span class="pas-sym">(</span><span class="pas-kwd">var</span><span class="pas-space"> </span><span class="pas-ident">Msg</span><span class="pas-sym">:</span><span class="pas-space"> </span><span class="pas-ident">TMessage</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">begin</span></pre>
<pre class="line"><span class="pas-space">  </span><span class="pas-ident">PaintTo</span><span class="pas-sym">(</span><span class="pas-ident">HDC</span><span class="pas-sym">(</span><span class="pas-ident">Msg</span><span class="pas-sym">.</span><span class="pas-ident">WParam</span><span class="pas-sym">)</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-sym">,</span><span class="pas-space"> </span><span class="pas-num">0</span><span class="pas-sym">)</span><span class="pas-sym">;</span></pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">;</span></pre>
<pre class="line"> </pre>
<pre class="line"><span class="pas-kwd">end</span><span class="pas-sym">.</span></pre>
</div>
</div>

<p>
  This is a sample component derived from <var>TGroupBox</var>. Although
  <var>TGroupBox</var> owns a window, it is not a common control window,
  therefore the <var>WM_PRINTCLIENT</var> message is not handled. Adding the
  message handler and using the <var>PaintTo</var> method to draw the control on
  a different display context is straightforward.
</p>

<p>
  And now the boring part: this must be done for every control you want to use
  on you forms; moreover you must change all your controls to the new ones
  before you can safely use the <var>AnimateWindow</var> API.
</p>

<p>
  Enjoy!
</p>

<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Unknown</td>
  </tr>
  <tr>
    <th scope="row">Contributor:</th>
    <td>Riccardo Faiella (Topellina)</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2012-07-06</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2012-07-06</td>
  </tr>
</table>

<div class="search noprint">
<form name="tipsSearchForm" id="tipsSearchForm" method="post" action="/tips">
<input class="text" type="text" name="txtSearch" id="txtSearch" value="" size="24" maxlength="80" />
<input class="button" type="submit" name="btnSearch" id="btnSearch" value="Search" />
</form>
</div>
<ul class="tip-nav noprint">
<li><a href="/tips/1">First</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/184">184</a></li>
<li><a href="/tips/185">185</a></li>
<li><a href="/tips/186">186</a></li>
<li><a href="/tips/187">187</a></li>
<li><span class="current">188</span></li>
<li><a href="/tips/189">189</a></li>
<li><a href="/tips/190">190</a></li>
<li><a href="/tips/191">191</a></li>
<li><a href="/tips/192">192</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/234">Last</a></li>
</ul>

<p class="centre-align noprint">
  &laquo; <a href="/tips">Return to contents</a> &raquo;
</p>

</div> <!-- #content -->
</div> <!-- #main -->
<div id="footer">
<div class="hide-from-css"><hr /></div> <!-- .hide-from-css -->
<a href="/copyright">Copyright</a> &copy; Peter Johnson (<a href="/background">DelphiDabbler</a>) 2002-2020</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
