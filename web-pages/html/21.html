<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>How to read image pixels fast</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="How to read image pixels fast" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="canonical" href="http://delphidabbler.com/tips/21" />
<link rel="stylesheet" href="/css/main.css" />
<link rel="stylesheet" href="/css/main-multicol-scr.css" media="screen" />
<link rel="stylesheet" href="/css/main-2col-scr.css" media="screen" />
<script type="text/javascript" src="/js/core.js"></script>
<script type="text/javascript" src="/js/offsite-win.js"></script>
<link rel="stylesheet" href="/css/tips.css" />
<script type="text/javascript" src="/js/popup-win.js"></script>
<script type="text/javascript" src="/js/show-hide.js"></script>
<link rel="alternate" href="/feeds/site-news-feed?id=tips" type="application/rss+xml" title="DelphiDabbler.com Tips News" />
<link rel="stylesheet" href="/css/source.css" />
<link rel="stylesheet" href="/css/js-detect.css" />
<script type="text/javascript" src="/js/js-detect.js"></script>
<script type="text/javascript">
  function showDemo(linkId, demoId) {
    showHide(linkId, demoId, 'Show demo code', 'Hide demo code');
  }
</script>
<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<script type="text/javascript">
    window.cookieconsent_options = {"message":"This site uses cookies to deliver its services, to enable targeted advertising and to support various social media buttons, and to analyse traffic. By using this site, you agree to its use of cookies.","dismiss":"Got it!","learnMore":"More info","link":"http://delphidabbler.com/subsid/cookies","theme":"dark-top"};
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
<!-- End Cookie Consent plugin -->
</head>
<body>
<!-- Facebook script -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="wrapper">
<div id="header">
<div class="hide-from-css">
<h1>DelphiDabbler.com</h1>
<p>Open source software, Delphi components, Tutorials &amp; more.</p>
</div> <!-- .hide-from-css -->
<div id="header-right">
<div id="quicklink" style="padding-right:4px;">
&raquo; <a href="/sitemap">Sitemap</a></div>
</div>
</div> <!-- #header -->
<div class="noprint" style="padding: 0 .5em .5em .5em; margin: .5em; background-color: #fcc;">
  <h2 class="smallcaps centre-align">
    &laquo;&laquo; Site Rescued &raquo;&raquo;
  </h2>
  <p class="highlight">
    While the site is still going to move from its current host, a new site will now take its place. <strong><a href="https://delphidabbler.blogspot.com/2020/03/delphidabblercom-is-no-longer-closing.html">More Info</a></strong>.
  </p>
  <p>
    The new site may have less content, but the core will now remain. And it will now play nicely with phones! Keep an eye on the <a href="https://delphidabbler.blogspot.com/">DelphiDabbler Blog</a> for news.
  </p>
</div>
<div id="navigation">
<hr class="hide-from-css" />
<h2 class="hide-from-css">Navigation</h2>
<ul>
<li><a href="/index">Home&nbsp;Page</a></li>
<li><a href="/programs">Programs</a></li>
<li><a href="/codelib">Delphi&nbsp;Library</a></li>
<li><a href="/snips-n-tips">Snippets&nbsp;&amp;&nbsp;Tips</a>
<ul>
<li class="sub-item"><a href="http://snippets.delphidabbler.com/" class="offsite-no-glyph">Code Snippets (Take 2)</a></li>
<li class="sub-item"><a href="/tips" class="selected ">Delphi&nbsp;Tips</a></li>
<li class="sub-item"><a href="http://swag.delphidabbler.com/" class="offsite-no-glyph">SWAG&nbsp;Archive</a></li>
</ul>
</li>
<li><a href="/articles">Articles</a></li>
<li><a href="http://wiki.delphidabbler.com/" class="offsite-no-glyph">Documentation</a></li>
<li><a href="/blog">Blog</a></li>
<li><a href="/news">News</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/background">About</a></li>
</ul>
</div> <!-- #navigation -->
<div id="main">
<div id="content">
<span class="help noprint">&raquo <a href="/help/tips-help.html" class="js-popup">Help</a></span>
<h1>
	How to read image pixels fast
</h1>

<div class="noprint">
<!-- style in following div and non-breaking spaces are a work around for a
     rendering bug in IE7 that sometimes hides preceeding h1 section if nothing
     is printed before this show_ads.js code is run.
     Tested and runs OK on Safari, Opera, Firefox, Chrome, but then, so did the
     original code! -->
<div class="centre-align" style="font-size:1pt;">&nbsp;
<script type="text/javascript"><!--
google_ad_client = "ca-pub-0907703677935617";
/* 468x60, created 11/04/09 */
google_ad_slot = "8060165044";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
&nbsp;
</div>
</div>
<p>
  Ever needed to modify/read a bitmap? Using <var>TBitamp.Canvas.Pixels</var>
  is works just fine, but when you try it with a larger bitmap you'll notice
  the problem.
</p>

<p>
  <var>TBitmap.Canvas.Pixels</var> provides an easy way to access pixels but
  it's very slow. A way to get around this is to use <var>ScanLine()</var> to
  work on the bitmap. What do we get back? Every timem you change
  <var>TBitmap.Canvas.Pixels</var> the bitmap is redrawn. This of course
  consumes resources and valuable time. <var>ScanLine()</var> leaves this
  decision up to you, the programmer. There is a little catch here, though.
  When using <var>Canvas.Pixels[]</var> you get in return a <var>TColor</var>
  value, but when using <var>ScanLine()</var> you get back the bytes of the
  line. What does this mean? Well, you have to worry about what is Red, Green
  and Blue. With <var>Canvas.Pixels[]</var> you could've used
  <var>GetRValue()</var>, <var>GetBValue()</var> or <var>GetGValue()</var>,
  but with scan line you have to remember: each pixel is made of 3 values:
  Red, Green and Blue. You have to make sure you are reading the correct
  value.
</p>

<p>
  Look at this code:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">var</span>
  iX  : Integer;
  Line: PByteArray;
...
  Line := Image1.ScanLine[<span class="pas-num">0</span>]; <span class="pas-comment">// We are scanning the first line</span>
  iX := <span class="pas-num">0</span>;
  <span class="pas-comment">// We can't use the 'for' loop because iX could not be modified from
  // within the loop</span>
  <span class="pas-kwd">repeat</span>
    Line[iX]     := Line[iX] - <span class="pas-hex">$F</span>; <span class="pas-comment">// Red value</span>
    Line[iX + <span class="pas-num">1</span>] := Line[iX] - <span class="pas-hex">$F</span>; <span class="pas-comment">// Green value</span>
    Line[iX + <span class="pas-num">2</span>] := Line[iX] - <span class="pas-hex">$F</span>; <span class="pas-comment">// Blue value</span>
    Inc(iX, <span class="pas-num">3</span>); <span class="pas-comment">// Move to next pixel</span>
  <span class="pas-kwd">until</span> iX &gt; (Image1.Width - <span class="pas-num">1</span>) * <span class="pas-num">3</span>;</pre>
</div>

<p>
  As you can see you each color is now made of 3 values, so if you
  miscalculate the next trio (may happen) you will be editing/reading garbage.
  Not only will you mix up Red, Green and Blue but you will be reading values
  from two neighbouring pixels.
</p>

<p>
  Here's code that show how to reads the Red and Blue values and switched
  them.
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">var</span>
  btTemp: Byte; <span class="pas-comment">// Used to swap colors</span>
  iY, iX: Integer;
  Line  : PByteArray;
...
  <span class="pas-kwd">for</span> iY := <span class="pas-num">0</span> <span class="pas-kwd">to</span> Image1.Height - <span class="pas-num">1</span> <span class="pas-kwd">do</span> <span class="pas-kwd">begin</span>
    Line := Image1.ScanLine[iY]; <span class="pas-comment">// Read the current line</span>
    <span class="pas-kwd">repeat</span>
      btSwap       := Line[iX];     <span class="pas-comment">// Save red value</span>
      Line[iX]     := Line[iX + <span class="pas-num">2</span>]; <span class="pas-comment">// Switch red with blue</span>
      Line[iX + <span class="pas-num">2</span>] := btSwap;       <span class="pas-comment">// Switch blue with previously saved red</span>
      <span class="pas-comment">// Line[iX + 1] - Green value, not used in example</span>
      Inc(iX, <span class="pas-num">3</span>);
    <span class="pas-kwd">until</span> iX &gt; (Image1.Width - <span class="pas-num">1</span>) * <span class="pas-num">3</span>;
  <span class="pas-kwd">end</span>;
  Image1.Invalidate; <span class="pas-comment">// Redraw bitmap after everything's done</span></pre>
</div>

<p>
  The example is quite simple yet it should explain the usage of this
  function.
</p>

<p class="callout">
  <strong>Note:</strong> This code only works with 24 bit pixel format bitmaps.
  You should ensure the bitmap's <var>PixelFormat</var> property is set to
  <var>pf24bit</var>.
</p>
<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Unknown</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2007-06-02</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2011-01-16</td>
  </tr>
</table>

<div class="search noprint">
<form name="tipsSearchForm" id="tipsSearchForm" method="post" action="/tips">
<input class="text" type="text" name="txtSearch" id="txtSearch" value="" size="24" maxlength="80" />
<input class="button" type="submit" name="btnSearch" id="btnSearch" value="Search" />
</form>
</div>
<ul class="tip-nav noprint">
<li><a href="/tips/1">First</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/17">17</a></li>
<li><a href="/tips/18">18</a></li>
<li><a href="/tips/19">19</a></li>
<li><a href="/tips/20">20</a></li>
<li><span class="current">21</span></li>
<li><a href="/tips/22">22</a></li>
<li><a href="/tips/23">23</a></li>
<li><a href="/tips/24">24</a></li>
<li><a href="/tips/25">25</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/234">Last</a></li>
</ul>

<p class="centre-align noprint">
  &laquo; <a href="/tips">Return to contents</a> &raquo;
</p>

</div> <!-- #content -->
</div> <!-- #main -->
<div id="footer">
<div class="hide-from-css"><hr /></div> <!-- .hide-from-css -->
<a href="/copyright">Copyright</a> &copy; Peter Johnson (<a href="/background">DelphiDabbler</a>) 2002-2020</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
