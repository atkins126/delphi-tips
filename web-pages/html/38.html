<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>How can I add my own custom menu item to another application?</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="How can I add my own custom menu item to another application?" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="canonical" href="http://delphidabbler.com/tips/38" />
<link rel="stylesheet" href="/css/main.css" />
<link rel="stylesheet" href="/css/main-multicol-scr.css" media="screen" />
<link rel="stylesheet" href="/css/main-2col-scr.css" media="screen" />
<script type="text/javascript" src="/js/core.js"></script>
<script type="text/javascript" src="/js/offsite-win.js"></script>
<link rel="stylesheet" href="/css/tips.css" />
<script type="text/javascript" src="/js/popup-win.js"></script>
<script type="text/javascript" src="/js/show-hide.js"></script>
<link rel="alternate" href="/feeds/site-news-feed?id=tips" type="application/rss+xml" title="DelphiDabbler.com Tips News" />
<link rel="stylesheet" href="/css/source.css" />
<link rel="stylesheet" href="/css/js-detect.css" />
<script type="text/javascript" src="/js/js-detect.js"></script>
<script type="text/javascript">
  function showDemo(linkId, demoId) {
    showHide(linkId, demoId, 'Show demo code', 'Hide demo code');
  }
</script>
<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<script type="text/javascript">
    window.cookieconsent_options = {"message":"This site uses cookies to deliver its services, to enable targeted advertising and to support various social media buttons, and to analyse traffic. By using this site, you agree to its use of cookies.","dismiss":"Got it!","learnMore":"More info","link":"http://delphidabbler.com/subsid/cookies","theme":"dark-top"};
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
<!-- End Cookie Consent plugin -->
</head>
<body>
<!-- Facebook script -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="wrapper">
<div id="header">
<div class="hide-from-css">
<h1>DelphiDabbler.com</h1>
<p>Open source software, Delphi components, Tutorials &amp; more.</p>
</div> <!-- .hide-from-css -->
<div id="header-right">
<div id="quicklink" style="padding-right:4px;">
&raquo; <a href="/sitemap">Sitemap</a></div>
</div>
</div> <!-- #header -->
<div class="noprint" style="padding: 0 .5em .5em .5em; margin: .5em; background-color: #fcc;">
  <h2 class="smallcaps centre-align">
    &laquo;&laquo; Site Rescued &raquo;&raquo;
  </h2>
  <p class="highlight">
    While the site is still going to move from its current host, a new site will now take its place. <strong><a href="https://delphidabbler.blogspot.com/2020/03/delphidabblercom-is-no-longer-closing.html">More Info</a></strong>.
  </p>
  <p>
    The new site may have less content, but the core will now remain. And it will now play nicely with phones! Keep an eye on the <a href="https://delphidabbler.blogspot.com/">DelphiDabbler Blog</a> for news.
  </p>
</div>
<div id="navigation">
<hr class="hide-from-css" />
<h2 class="hide-from-css">Navigation</h2>
<ul>
<li><a href="/index">Home&nbsp;Page</a></li>
<li><a href="/programs">Programs</a></li>
<li><a href="/codelib">Delphi&nbsp;Library</a></li>
<li><a href="/snips-n-tips">Snippets&nbsp;&amp;&nbsp;Tips</a>
<ul>
<li class="sub-item"><a href="http://snippets.delphidabbler.com/" class="offsite-no-glyph">Code Snippets (Take 2)</a></li>
<li class="sub-item"><a href="/tips" class="selected ">Delphi&nbsp;Tips</a></li>
<li class="sub-item"><a href="http://swag.delphidabbler.com/" class="offsite-no-glyph">SWAG&nbsp;Archive</a></li>
</ul>
</li>
<li><a href="/articles">Articles</a></li>
<li><a href="http://wiki.delphidabbler.com/" class="offsite-no-glyph">Documentation</a></li>
<li><a href="/blog">Blog</a></li>
<li><a href="/news">News</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/background">About</a></li>
</ul>
</div> <!-- #navigation -->
<div id="main">
<div id="content">
<span class="help noprint">&raquo <a href="/help/tips-help.html" class="js-popup">Help</a></span>
<h1>
	How can I add my own custom menu item to another application?
</h1>

<div class="noprint">
<!-- style in following div and non-breaking spaces are a work around for a
     rendering bug in IE7 that sometimes hides preceeding h1 section if nothing
     is printed before this show_ads.js code is run.
     Tested and runs OK on Safari, Opera, Firefox, Chrome, but then, so did the
     original code! -->
<div class="centre-align" style="font-size:1pt;">&nbsp;
<script type="text/javascript"><!--
google_ad_client = "ca-pub-0907703677935617";
/* 468x60, created 11/04/09 */
google_ad_slot = "8060165044";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
&nbsp;
</div>
</div>
<p>
  This tip is something that I've wanted to do for a while, but kept on
  forgetting to write the article for it. It involves adding a menu choice to
  the system menu of an application. For the most part, you'll never have a
  need to do this. But there are some things like setting a form style, or
  some other action that is more system oriented than application oriented
  that just belong in the system menu. Well, here it is folks, and as usual,
  it's pretty incredibly easy to implement.
</p>

<p>
  If you've tried to do this before but couldn't, it's because there is no way
  to add a menu item with standard Delphi calls. You have to trap Windows the
  windows message <var>WM_SYSCOMMAND</var> and evaluate the <var>wParam</var>
  message element to see if your added menu item was selected. Really folks,
  it's not that hard, and a little digging in the API help was all I needed to
  do find out how to implement this in a program. Basically, what you have to
  do is this:
</p>

<p>
  Create a new form. Override the <var>OnMessage</var> event by assigning a
  new event handler procedure for the <var>OnMessage</var> event. Create a
  constant that will be used as the ordinal identifier for your menu choice.
  In the <var>FormCreate</var>, make your menu choice with the
  <var>AppendMenu</var> API call. Here's the code to show you how to do it:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">uses</span>
  SysUtils, WinTypes, WinProcs, Messages, Classes,
  Graphics, Controls, Forms, Dialogs, Menus;

<span class="pas-kwd">type</span>
  TForm1 = <span class="pas-kwd">class</span>(TForm)
    <span class="pas-kwd">procedure</span> FormCreate(Sender: TObject);
  <span class="pas-kwd">private</span>
    <span class="pas-comment">{ ... }</span>
  <span class="pas-kwd">public</span>
    <span class="pas-comment">{ This declaration is of the type TMessageEvent which is a pointer to a</span>
<span class="pas-comment">      procedure that takes two variable arguments of type TMsg and Boolean,</span>
<span class="pas-comment">      respectively }</span>
    <span class="pas-kwd">procedure</span> WinMsgHandler(<span class="pas-kwd">var</span> Msg : TMsg; <span class="pas-kwd">var</span> Handled : Boolean);
  <span class="pas-kwd">end</span>;

<span class="pas-kwd">var</span>
  Form1: TForm1;

<span class="pas-kwd">const</span>
  MyItem = <span class="pas-num">100</span>; <span class="pas-comment">// Here's the menu identifier. It can be any WORD value</span>

<span class="pas-kwd">implementation</span>

<span class="pas-preproc">{$R *.DFM}</span>

<span class="pas-kwd">procedure</span> TForm1.FormCreate(Sender: TObject);
<span class="pas-kwd">begin</span>
  <span class="pas-comment">{ First, tell the application that its message handler is different from the</span>
<span class="pas-comment">    default }</span>
  Application.OnMessage := WinMsgHandler;
  <span class="pas-comment">{ Add a separator }</span>
  AppendMenu(GetSystemMenu(Self.Handle, False), MF_SEPARATOR, <span class="pas-num">0</span>, <span class="pas-str">''</span>);
  <span class="pas-comment">{ Add your menu choice. Since the Item ID is high, using the MF_BYPOSITION</span>
<span class="pas-comment">    constant will place it last on the system menu }</span>
  AppendMenu(GetSystemMenu(Self.Handle, False),
    MF_BYPOSITION, MyItem, <span class="pas-str">'My Men&amp;u Choice'</span>);
<span class="pas-kwd">end</span>;

<span class="pas-kwd">procedure</span> TForm1.WinMsgHandler(<span class="pas-kwd">var</span> Msg: TMsg; <span class="pas-kwd">var</span> Handled: Boolean);
<span class="pas-kwd">begin</span>
  <span class="pas-comment">{ If the message is a system one... }</span>
  <span class="pas-kwd">if</span> Msg.<span class="pas-kwd">Message</span>=WM_SYSCOMMAND <span class="pas-kwd">then</span>
    <span class="pas-kwd">if</span> Msg.wParam = MyItem <span class="pas-kwd">then</span>
      <span class="pas-comment">{ Put handling code here. I've opted for a ShowMessage for demonstration </span>
<span class="pas-comment">        purposes }</span>
     ShowMessage(<span class="pas-str">'You picked my menu!!!'</span>);
<span class="pas-kwd">end</span>;

<span class="pas-kwd">end</span>.</pre>
</div>

<p>
  As you can see, this is fairly straight-forward. Granted, the tip is not
  very complicated. However, it does open up many doors to things you can do.
  In anticipation of some questions you might have later, The
  <var>AppendMenu</var> command can also be used with minimized apps. For
  instance, if you minimize your app, the icon represents the application, not
  your form. Therefore in order to make the system menu with your changes
  visible when in minimized form you would use <var>Application.Handle</var>
  instead of <var>Self.Handle</var> to deal with the application's system
  menu.
</p>




<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Unknown</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2007-06-02</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2007-06-02</td>
  </tr>
</table>

<div class="search noprint">
<form name="tipsSearchForm" id="tipsSearchForm" method="post" action="/tips">
<input class="text" type="text" name="txtSearch" id="txtSearch" value="" size="24" maxlength="80" />
<input class="button" type="submit" name="btnSearch" id="btnSearch" value="Search" />
</form>
</div>
<ul class="tip-nav noprint">
<li><a href="/tips/1">First</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/34">34</a></li>
<li><a href="/tips/35">35</a></li>
<li><a href="/tips/36">36</a></li>
<li><a href="/tips/37">37</a></li>
<li><span class="current">38</span></li>
<li><a href="/tips/39">39</a></li>
<li><a href="/tips/40">40</a></li>
<li><a href="/tips/41">41</a></li>
<li><a href="/tips/42">42</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/234">Last</a></li>
</ul>

<p class="centre-align noprint">
  &laquo; <a href="/tips">Return to contents</a> &raquo;
</p>

</div> <!-- #content -->
</div> <!-- #main -->
<div id="footer">
<div class="hide-from-css"><hr /></div> <!-- .hide-from-css -->
<a href="/copyright">Copyright</a> &copy; Peter Johnson (<a href="/background">DelphiDabbler</a>) 2002-2020</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
