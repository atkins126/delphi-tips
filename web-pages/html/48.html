<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Animate tray application windows as they open and close</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="Animate tray application windows as they open and close" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="canonical" href="http://delphidabbler.com/tips/48" />
<link rel="stylesheet" href="/css/main.css" />
<link rel="stylesheet" href="/css/main-multicol-scr.css" media="screen" />
<link rel="stylesheet" href="/css/main-2col-scr.css" media="screen" />
<script type="text/javascript" src="/js/core.js"></script>
<script type="text/javascript" src="/js/offsite-win.js"></script>
<link rel="stylesheet" href="/css/tips.css" />
<script type="text/javascript" src="/js/popup-win.js"></script>
<script type="text/javascript" src="/js/show-hide.js"></script>
<link rel="alternate" href="/feeds/site-news-feed?id=tips" type="application/rss+xml" title="DelphiDabbler.com Tips News" />
<link rel="stylesheet" href="/css/source.css" />
<link rel="stylesheet" href="/css/js-detect.css" />
<script type="text/javascript" src="/js/js-detect.js"></script>
<script type="text/javascript">
  function showDemo(linkId, demoId) {
    showHide(linkId, demoId, 'Show demo code', 'Hide demo code');
  }
</script>
<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<script type="text/javascript">
    window.cookieconsent_options = {"message":"This site uses cookies to deliver its services, to enable targeted advertising and to support various social media buttons, and to analyse traffic. By using this site, you agree to its use of cookies.","dismiss":"Got it!","learnMore":"More info","link":"http://delphidabbler.com/subsid/cookies","theme":"dark-top"};
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
<!-- End Cookie Consent plugin -->
</head>
<body>
<!-- Facebook script -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="wrapper">
<div id="header">
<div class="hide-from-css">
<h1>DelphiDabbler.com</h1>
<p>Open source software, Delphi components, Tutorials &amp; more.</p>
</div> <!-- .hide-from-css -->
<div id="header-right">
<div id="quicklink" style="padding-right:4px;">
&raquo; <a href="/sitemap">Sitemap</a></div>
</div>
</div> <!-- #header -->
<div class="noprint" style="padding: 0 .5em .5em .5em; margin: .5em; background-color: #fcc;">
  <h2 class="smallcaps centre-align">
    &laquo;&laquo; Site Rescued &raquo;&raquo;
  </h2>
  <p class="highlight">
    While the site is still going to move from its current host, a new site will now take its place. <strong><a href="https://delphidabbler.blogspot.com/2020/03/delphidabblercom-is-no-longer-closing.html">More Info</a></strong>.
  </p>
  <p>
    The new site may have less content, but the core will now remain. And it will now play nicely with phones! Keep an eye on the <a href="https://delphidabbler.blogspot.com/">DelphiDabbler Blog</a> for news.
  </p>
</div>
<div id="navigation">
<hr class="hide-from-css" />
<h2 class="hide-from-css">Navigation</h2>
<ul>
<li><a href="/index">Home&nbsp;Page</a></li>
<li><a href="/programs">Programs</a></li>
<li><a href="/codelib">Delphi&nbsp;Library</a></li>
<li><a href="/snips-n-tips">Snippets&nbsp;&amp;&nbsp;Tips</a>
<ul>
<li class="sub-item"><a href="http://snippets.delphidabbler.com/" class="offsite-no-glyph">Code Snippets (Take 2)</a></li>
<li class="sub-item"><a href="/tips" class="selected ">Delphi&nbsp;Tips</a></li>
<li class="sub-item"><a href="http://swag.delphidabbler.com/" class="offsite-no-glyph">SWAG&nbsp;Archive</a></li>
</ul>
</li>
<li><a href="/articles">Articles</a></li>
<li><a href="http://wiki.delphidabbler.com/" class="offsite-no-glyph">Documentation</a></li>
<li><a href="/blog">Blog</a></li>
<li><a href="/news">News</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/background">About</a></li>
</ul>
</div> <!-- #navigation -->
<div id="main">
<div id="content">
<span class="help noprint">&raquo <a href="/help/tips-help.html" class="js-popup">Help</a></span>
<h1>
	Animate tray application windows as they open and close
</h1>

<div class="noprint">
<!-- style in following div and non-breaking spaces are a work around for a
     rendering bug in IE7 that sometimes hides preceeding h1 section if nothing
     is printed before this show_ads.js code is run.
     Tested and runs OK on Safari, Opera, Firefox, Chrome, but then, so did the
     original code! -->
<div class="centre-align" style="font-size:1pt;">&nbsp;
<script type="text/javascript"><!--
google_ad_client = "ca-pub-0907703677935617";
/* 468x60, created 11/04/09 */
google_ad_slot = "8060165044";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
&nbsp;
</div>
</div>
<p>
  Have you noticed that when you close the window of a tray application it
  often doesn't actually close the application but simply hides the window and
  leaves the application running in the tray: it effectively minimizes the
  application to the tray. There's usually no visual clue that this has
  happened as there would be if you minimized a normal application.
</p>

<p>
  We can change this behaviour by using the <var>DrawAnimatedRects</var>
  Windows API function. (See <a href="/tips/46">Tip #46</a> for an explanation of this function.)
</p>

<p>
  Here is a little static class that your tray applications can use to animate
  the window caption, zooming to the tray when the window closes and zooming
  from the tray when it opens.
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">unit</span> UTrayZoom;

<span class="pas-kwd">interface</span>

<span class="pas-kwd">uses</span>
  Windows;

<span class="pas-kwd">type</span>
  TTrayZoom = <span class="pas-kwd">class</span>(TObject)
  <span class="pas-kwd">private</span>
    <span class="pas-kwd">class</span> <span class="pas-kwd">function</span> GetTrayRect: TRect;
    <span class="pas-kwd">class</span> <span class="pas-kwd">procedure</span> DoZoom(<span class="pas-kwd">const</span> Wnd: HWND; <span class="pas-kwd">const</span> Src, Dest: TRect);
  <span class="pas-kwd">public</span>
    <span class="pas-kwd">class</span> <span class="pas-kwd">procedure</span> ZoomToTray(<span class="pas-kwd">const</span> Wnd: HWND);
    <span class="pas-kwd">class</span> <span class="pas-kwd">procedure</span> ZoomFromTray(<span class="pas-kwd">const</span> Wnd: HWND);
  <span class="pas-kwd">end</span>;

<span class="pas-kwd">implementation</span>

<span class="pas-kwd">class</span> <span class="pas-kwd">procedure</span> TTrayZoom.DoZoom(<span class="pas-kwd">const</span> Wnd: HWND; <span class="pas-kwd">const</span> Src, Dest: TRect);
<span class="pas-kwd">begin</span>
  DrawAnimatedRects(Wnd, IDANI_CAPTION, Src, Dest);
<span class="pas-kwd">end</span>;

<span class="pas-kwd">class</span> <span class="pas-kwd">function</span> TTrayZoom.GetTrayRect: TRect;
<span class="pas-kwd">var</span>
  TaskbarWnd, TrayWnd: HWND;
<span class="pas-kwd">begin</span>
  TaskbarWnd := FindWindow(<span class="pas-str">'Shell_TrayWnd'</span>, <span class="pas-kwd">nil</span>);
  TrayWnd := FindWindowEx(TaskbarWnd, <span class="pas-num">0</span>, <span class="pas-str">'TrayNotifyWnd'</span>, <span class="pas-kwd">nil</span>);
  GetWindowRect(TrayWnd, Result);
<span class="pas-kwd">end</span>;

<span class="pas-kwd">class</span> <span class="pas-kwd">procedure</span> TTrayZoom.ZoomFromTray(<span class="pas-kwd">const</span> Wnd: HWND);
<span class="pas-kwd">var</span>
  WndRect: TRect;
<span class="pas-kwd">begin</span>
  GetWindowRect(Wnd, WndRect);
  DoZoom(Wnd, GetTrayRect, WndRect);
<span class="pas-kwd">end</span>;

<span class="pas-kwd">class</span> <span class="pas-kwd">procedure</span> TTrayZoom.ZoomToTray(<span class="pas-kwd">const</span> Wnd: HWND);
<span class="pas-kwd">var</span>
  WndRect: TRect;
<span class="pas-kwd">begin</span>
  GetWindowRect(Wnd, WndRect);
  DoZoom(Wnd, WndRect, GetTrayRect);
<span class="pas-kwd">end</span>;

<span class="pas-kwd">end</span>.</pre>
</div>

<p class="credits">
  Inspired by code from the Delphi3000.com article #1862 by Gian Luca Pepe
</p>

<p>
  The <var>DoZoom</var> method simply wraps the call to
  <var>DrawAnimatedRects</var>. <var>GetTrayRect</var> gets the bounding
  rectangle of the tray area of the task bar. (See <a href="/tips/47">Tip #47</a> for details of how to find the tray window handle.) The two public
  methods <var>ZoomToTray</var> and <var>ZoomFromTray</var> zoom the specified
  window to and from the tray respectively. The <var>Wnd</var> parameter to
  these methods should be the window handle of the form that you are zooming
  to and from the tray.
</p>

<h2>
  Usage
</h2>

<p>
  When your tray application is opening from the tray call
  <var>TTrayZoom.ZoomFromTray</var>. You may possibly do this in a menu item's
  <var>OnClick</var> event handler. When your application is closing to the
  tray call <var>TTrayZoom.ZoomToTray</var>. This may be done in the form's
  <var>OnClose</var> or <var>OnCloseQuery</var> event handlers. Exactly where
  and when you call <var>TTrayZoom</var>'s methods will vary from application
  to application.
</p>

<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Peter Johnson</td>
  </tr>
  <tr>
    <th scope="row">Contributor:</th>
    <td>Peter Johnson</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2007-08-14</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2007-08-14</td>
  </tr>
</table>

<div class="search noprint">
<form name="tipsSearchForm" id="tipsSearchForm" method="post" action="/tips">
<input class="text" type="text" name="txtSearch" id="txtSearch" value="" size="24" maxlength="80" />
<input class="button" type="submit" name="btnSearch" id="btnSearch" value="Search" />
</form>
</div>
<ul class="tip-nav noprint">
<li><a href="/tips/1">First</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/44">44</a></li>
<li><a href="/tips/45">45</a></li>
<li><a href="/tips/46">46</a></li>
<li><a href="/tips/47">47</a></li>
<li><span class="current">48</span></li>
<li><a href="/tips/49">49</a></li>
<li><a href="/tips/50">50</a></li>
<li><a href="/tips/51">51</a></li>
<li><a href="/tips/52">52</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/234">Last</a></li>
</ul>

<p class="centre-align noprint">
  &laquo; <a href="/tips">Return to contents</a> &raquo;
</p>

</div> <!-- #content -->
</div> <!-- #main -->
<div id="footer">
<div class="hide-from-css"><hr /></div> <!-- .hide-from-css -->
<a href="/copyright">Copyright</a> &copy; Peter Johnson (<a href="/background">DelphiDabbler</a>) 2002-2020</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
