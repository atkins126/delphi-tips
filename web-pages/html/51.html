<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Communicate between processes using windows messaging</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="Communicate between processes using windows messaging" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="canonical" href="http://delphidabbler.com/tips/51" />
<link rel="stylesheet" href="/css/main.css" />
<link rel="stylesheet" href="/css/main-multicol-scr.css" media="screen" />
<link rel="stylesheet" href="/css/main-2col-scr.css" media="screen" />
<script type="text/javascript" src="/js/core.js"></script>
<script type="text/javascript" src="/js/offsite-win.js"></script>
<link rel="stylesheet" href="/css/tips.css" />
<script type="text/javascript" src="/js/popup-win.js"></script>
<script type="text/javascript" src="/js/show-hide.js"></script>
<link rel="alternate" href="/feeds/site-news-feed?id=tips" type="application/rss+xml" title="DelphiDabbler.com Tips News" />
<link rel="stylesheet" href="/css/source.css" />
<link rel="stylesheet" href="/css/js-detect.css" />
<script type="text/javascript" src="/js/js-detect.js"></script>
<script type="text/javascript">
  function showDemo(linkId, demoId) {
    showHide(linkId, demoId, 'Show demo code', 'Hide demo code');
  }
</script>
<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<script type="text/javascript">
    window.cookieconsent_options = {"message":"This site uses cookies to deliver its services, to enable targeted advertising and to support various social media buttons, and to analyse traffic. By using this site, you agree to its use of cookies.","dismiss":"Got it!","learnMore":"More info","link":"http://delphidabbler.com/subsid/cookies","theme":"dark-top"};
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
<!-- End Cookie Consent plugin -->
</head>
<body>
<!-- Facebook script -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="wrapper">
<div id="header">
<div class="hide-from-css">
<h1>DelphiDabbler.com</h1>
<p>Open source software, Delphi components, Tutorials &amp; more.</p>
</div> <!-- .hide-from-css -->
<div id="header-right">
<div id="quicklink" style="padding-right:4px;">
&raquo; <a href="/sitemap">Sitemap</a></div>
</div>
</div> <!-- #header -->
<div class="noprint" style="padding: 0 .5em .5em .5em; margin: .5em; background-color: #fcc;">
  <h2 class="smallcaps centre-align">
    &laquo;&laquo; Site Rescued &raquo;&raquo;
  </h2>
  <p class="highlight">
    While the site is still going to move from its current host, a new site will now take its place. <strong><a href="https://delphidabbler.blogspot.com/2020/03/delphidabblercom-is-no-longer-closing.html">More Info</a></strong>.
  </p>
  <p>
    The new site may have less content, but the core will now remain. And it will now play nicely with phones! Keep an eye on the <a href="https://delphidabbler.blogspot.com/">DelphiDabbler Blog</a> for news.
  </p>
</div>
<div id="navigation">
<hr class="hide-from-css" />
<h2 class="hide-from-css">Navigation</h2>
<ul>
<li><a href="/index">Home&nbsp;Page</a></li>
<li><a href="/programs">Programs</a></li>
<li><a href="/codelib">Delphi&nbsp;Library</a></li>
<li><a href="/snips-n-tips">Snippets&nbsp;&amp;&nbsp;Tips</a>
<ul>
<li class="sub-item"><a href="http://snippets.delphidabbler.com/" class="offsite-no-glyph">Code Snippets (Take 2)</a></li>
<li class="sub-item"><a href="/tips" class="selected ">Delphi&nbsp;Tips</a></li>
<li class="sub-item"><a href="http://swag.delphidabbler.com/" class="offsite-no-glyph">SWAG&nbsp;Archive</a></li>
</ul>
</li>
<li><a href="/articles">Articles</a></li>
<li><a href="http://wiki.delphidabbler.com/" class="offsite-no-glyph">Documentation</a></li>
<li><a href="/blog">Blog</a></li>
<li><a href="/news">News</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/background">About</a></li>
</ul>
</div> <!-- #navigation -->
<div id="main">
<div id="content">
<span class="help noprint">&raquo <a href="/help/tips-help.html" class="js-popup">Help</a></span>
<h1>
	Communicate between processes using windows messaging
</h1>

<div class="noprint">
<!-- style in following div and non-breaking spaces are a work around for a
     rendering bug in IE7 that sometimes hides preceeding h1 section if nothing
     is printed before this show_ads.js code is run.
     Tested and runs OK on Safari, Opera, Firefox, Chrome, but then, so did the
     original code! -->
<div class="centre-align" style="font-size:1pt;">&nbsp;
<script type="text/javascript"><!--
google_ad_client = "ca-pub-0907703677935617";
/* 468x60, created 11/04/09 */
google_ad_slot = "8060165044";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
&nbsp;
</div>
</div>
<p>
  Windows messaging is an easy way for processes to communicate. Below, you
  will find an example of sending such messages, as well as an example message
  handler to receive them.
</p>

<p>
  Please keep in mind that there is no guarantee that your process will
  receive this message. Or, it may receive it instantaneously. I recommend
  sending some sort of ACK response back to the originating app so I knows it
  was received properly.
</p>

<h2>
  Sender
</h2>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-comment">// wmCopyData</span>
<span class="pas-comment">// Allows inter-process communications via Windows WM_COPYDATA messaging.</span>
<span class="pas-kwd">procedure</span> wmCopyData(WndClass:PChar;WndTitle:PChar;Msg:<span class="pas-kwd">String</span>);
<span class="pas-kwd">var</span>
  hWnd  : THandle         <span class="pas-comment">// Handle to target window to receive message</span>
  cds   : CopyDataStruct; <span class="pas-comment">// Structure to package the outbound message</span>
<span class="pas-kwd">begin</span>
  <span class="pas-comment">// Find target window</span>
  hWnd := FindWindow(PChar(WndClass), PChar(WndTitle));
  <span class="pas-kwd">try</span>
    cds.dwData := <span class="pas-num">0</span>
    cds.cbData := Length(Msg);   <span class="pas-comment">// Length of message</span>
    cds.lpData := PChar(Msg);    <span class="pas-comment">// Actual message</span>
    <span class="pas-comment">// The following function is not necessary for this to work</span>
    SetForegroundWindow(hWnd);   <span class="pas-comment">// Pulls target window up top</span>
    SendMessage(hWnd, wm_CopyData, <span class="pas-num">0</span>, Integer(@cds));
send the <span class="pas-kwd">message</span>
  <span class="pas-kwd">finally</span>
    CloseHandle(hWnd)            <span class="pas-comment">// Close handle to target</span>
  <span class="pas-kwd">end</span>;
<span class="pas-kwd">end</span>;</pre>
</div>

<p>
  A typical call to this procedure would be:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source">wmCopyData(<span class="pas-str">'NOTEPAD'</span>,<span class="pas-str">'Untitled - Notepad'</span>,<span class="pas-str">'Test Message'</span>);</pre>
</div>

<p>
  Keep in mind that <em>Notepad</em> does not have a handler to receive
  messages sent via <var>WM_COPYDATA</var>.
</p>

<p>
  Also, it is not necessary to use both the Class name and Window title text,
  one is sufficient. However, if you have multiple copies open, it will go to
  the first one it finds.
</p>


<h2>
  Receiver
</h2>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-comment">// Add a custom message handler so our app gets notified upon receipt</span>
<span class="pas-kwd">private</span>
  <span class="pas-kwd">procedure</span> WMGetData(<span class="pas-kwd">var</span> Msg: TWMCopyData); <span class="pas-kwd">message</span> WM_COPYDATA;

<span class="pas-comment">// wmGetData</span>
<span class="pas-comment">// Receives inbound messages - Callback function</span>
<span class="pas-comment">// Called from message handler</span>
<span class="pas-kwd">procedure</span> TForm1.wmGetData(<span class="pas-kwd">var</span> Msg: TWMCopyData);
<span class="pas-kwd">var</span>
  sText: <span class="pas-kwd">array</span>[<span class="pas-num">0</span>..<span class="pas-num">255</span>] <span class="pas-kwd">of</span> Char;  <span class="pas-comment">// Create an array to store message in</span>
<span class="pas-kwd">begin</span>
  <span class="pas-comment">// Cast inbound data structure into a character array</span>
  StrLCopy(sText, Msg.CopyDataStruct.lpData, Msg.CopyDataStruct.cbData);
  Edit1.Text := sText;
<span class="pas-kwd">end</span>;</pre>
</div>

<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Dennis LV</td>
  </tr>
  <tr>
    <th scope="row">Contributor:</th>
    <td>Dennis LV</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2007-08-31</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2007-08-31</td>
  </tr>
</table>

<div class="search noprint">
<form name="tipsSearchForm" id="tipsSearchForm" method="post" action="/tips">
<input class="text" type="text" name="txtSearch" id="txtSearch" value="" size="24" maxlength="80" />
<input class="button" type="submit" name="btnSearch" id="btnSearch" value="Search" />
</form>
</div>
<ul class="tip-nav noprint">
<li><a href="/tips/1">First</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/47">47</a></li>
<li><a href="/tips/48">48</a></li>
<li><a href="/tips/49">49</a></li>
<li><a href="/tips/50">50</a></li>
<li><span class="current">51</span></li>
<li><a href="/tips/52">52</a></li>
<li><a href="/tips/53">53</a></li>
<li><a href="/tips/54">54</a></li>
<li><a href="/tips/55">55</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/234">Last</a></li>
</ul>

<p class="centre-align noprint">
  &laquo; <a href="/tips">Return to contents</a> &raquo;
</p>

</div> <!-- #content -->
</div> <!-- #main -->
<div id="footer">
<div class="hide-from-css"><hr /></div> <!-- .hide-from-css -->
<a href="/copyright">Copyright</a> &copy; Peter Johnson (<a href="/background">DelphiDabbler</a>) 2002-2020</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
