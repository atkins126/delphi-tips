<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Finding HTML elements by ID in a TWebBrowser document</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="Finding HTML elements by ID in a TWebBrowser document" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="canonical" href="http://delphidabbler.com/tips/56" />
<link rel="stylesheet" href="/css/main.css" />
<link rel="stylesheet" href="/css/main-multicol-scr.css" media="screen" />
<link rel="stylesheet" href="/css/main-2col-scr.css" media="screen" />
<script type="text/javascript" src="/js/core.js"></script>
<script type="text/javascript" src="/js/offsite-win.js"></script>
<link rel="stylesheet" href="/css/tips.css" />
<script type="text/javascript" src="/js/popup-win.js"></script>
<script type="text/javascript" src="/js/show-hide.js"></script>
<link rel="alternate" href="/feeds/site-news-feed?id=tips" type="application/rss+xml" title="DelphiDabbler.com Tips News" />
<link rel="stylesheet" href="/css/source.css" />
<link rel="stylesheet" href="/css/js-detect.css" />
<script type="text/javascript" src="/js/js-detect.js"></script>
<script type="text/javascript">
  function showDemo(linkId, demoId) {
    showHide(linkId, demoId, 'Show demo code', 'Hide demo code');
  }
</script>
<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
<script type="text/javascript">
    window.cookieconsent_options = {"message":"This site uses cookies to deliver its services, to enable targeted advertising and to support various social media buttons, and to analyse traffic. By using this site, you agree to its use of cookies.","dismiss":"Got it!","learnMore":"More info","link":"http://delphidabbler.com/subsid/cookies","theme":"dark-top"};
</script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/1.0.9/cookieconsent.min.js"></script>
<!-- End Cookie Consent plugin -->
</head>
<body>
<!-- Facebook script -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="wrapper">
<div id="header">
<div class="hide-from-css">
<h1>DelphiDabbler.com</h1>
<p>Open source software, Delphi components, Tutorials &amp; more.</p>
</div> <!-- .hide-from-css -->
<div id="header-right">
<div id="quicklink" style="padding-right:4px;">
&raquo; <a href="/sitemap">Sitemap</a></div>
</div>
</div> <!-- #header -->
<div class="noprint" style="padding: 0 .5em .5em .5em; margin: .5em; background-color: #fcc;">
  <h2 class="smallcaps centre-align">
    &laquo;&laquo; Site Rescued &raquo;&raquo;
  </h2>
  <p class="highlight">
    While the site is still going to move from its current host, a new site will now take its place. <strong><a href="https://delphidabbler.blogspot.com/2020/03/delphidabblercom-is-no-longer-closing.html">More Info</a></strong>.
  </p>
  <p>
    The new site may have less content, but the core will now remain. And it will now play nicely with phones! Keep an eye on the <a href="https://delphidabbler.blogspot.com/">DelphiDabbler Blog</a> for news.
  </p>
</div>
<div id="navigation">
<hr class="hide-from-css" />
<h2 class="hide-from-css">Navigation</h2>
<ul>
<li><a href="/index">Home&nbsp;Page</a></li>
<li><a href="/programs">Programs</a></li>
<li><a href="/codelib">Delphi&nbsp;Library</a></li>
<li><a href="/snips-n-tips">Snippets&nbsp;&amp;&nbsp;Tips</a>
<ul>
<li class="sub-item"><a href="http://snippets.delphidabbler.com/" class="offsite-no-glyph">Code Snippets (Take 2)</a></li>
<li class="sub-item"><a href="/tips" class="selected ">Delphi&nbsp;Tips</a></li>
<li class="sub-item"><a href="http://swag.delphidabbler.com/" class="offsite-no-glyph">SWAG&nbsp;Archive</a></li>
</ul>
</li>
<li><a href="/articles">Articles</a></li>
<li><a href="http://wiki.delphidabbler.com/" class="offsite-no-glyph">Documentation</a></li>
<li><a href="/blog">Blog</a></li>
<li><a href="/news">News</a></li>
<li><a href="/contact">Contact</a></li>
<li><a href="/background">About</a></li>
</ul>
</div> <!-- #navigation -->
<div id="main">
<div id="content">
<span class="help noprint">&raquo <a href="/help/tips-help.html" class="js-popup">Help</a></span>
<h1>
	Finding HTML elements by ID in a TWebBrowser document
</h1>

<div class="noprint">
<!-- style in following div and non-breaking spaces are a work around for a
     rendering bug in IE7 that sometimes hides preceeding h1 section if nothing
     is printed before this show_ads.js code is run.
     Tested and runs OK on Safari, Opera, Firefox, Chrome, but then, so did the
     original code! -->
<div class="centre-align" style="font-size:1pt;">&nbsp;
<script type="text/javascript"><!--
google_ad_client = "ca-pub-0907703677935617";
/* 468x60, created 11/04/09 */
google_ad_slot = "8060165044";
google_ad_width = 468;
google_ad_height = 60;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
&nbsp;
</div>
</div>
<p>
  It's often useful to be able to find HTML elements using the elements' ID
  attribute, because it is unique in a HTML document.
</p>

<p>
  JavaScript provides a built-in method to do that &ndash;
  <var>document.getElementById</var>. Unfortunately there isn't a similar
  method available from <code>MSHTML</code> for use with HTML documents
  loaded into a <var>TWebBrowser</var>. So we need to provide our own. Here's
  the code:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">uses</span>
  MSHTML, SysUtils, Variants;

<span class="pas-kwd">function</span> GetElementById(<span class="pas-kwd">const</span> Doc: IDispatch; <span class="pas-kwd">const</span> Id: <span class="pas-kwd">string</span>): IDispatch;
<span class="pas-kwd">var</span>
  Document: IHTMLDocument2;     <span class="pas-comment">// IHTMLDocument2 interface of Doc</span>
  Body: IHTMLElement2;          <span class="pas-comment">// document body element</span>
  Tags: IHTMLElementCollection; <span class="pas-comment">// all tags in document body</span>
  Tag: IHTMLElement;            <span class="pas-comment">// a tag in document body</span>
  I: Integer;                   <span class="pas-comment">// loops thru tags in document body</span>
<span class="pas-kwd">begin</span>
  Result := <span class="pas-kwd">nil</span>;
  <span class="pas-comment">// Check for valid document: require IHTMLDocument2 interface to it</span>
  <span class="pas-kwd">if</span> <span class="pas-kwd">not</span> Supports(Doc, IHTMLDocument2, Document) <span class="pas-kwd">then</span>
    <span class="pas-kwd">raise</span> Exception.Create(<span class="pas-str">'Invalid HTML document'</span>);
  <span class="pas-comment">// Check for valid body element: require IHTMLElement2 interface to it</span>
  <span class="pas-kwd">if</span> <span class="pas-kwd">not</span> Supports(Document.body, IHTMLElement2, Body) <span class="pas-kwd">then</span>
    <span class="pas-kwd">raise</span> Exception.Create(<span class="pas-str">'Can''t find &lt;body&gt; element'</span>);
  <span class="pas-comment">// Get all tags in body element ('*' =&gt; any tag name)</span>
  Tags := Body.getElementsByTagName(<span class="pas-str">'*'</span>);
  <span class="pas-comment">// Scan through all tags in body</span>
  <span class="pas-kwd">for</span> I := <span class="pas-num">0</span> <span class="pas-kwd">to</span> Pred(Tags.length) <span class="pas-kwd">do</span>
  <span class="pas-kwd">begin</span>
    <span class="pas-comment">// Get reference to a tag</span>
    Tag := Tags.item(I, EmptyParam) <span class="pas-kwd">as</span> IHTMLElement;
    <span class="pas-comment">// Check tag's id and return it if id matches</span>
    <span class="pas-kwd">if</span> AnsiSameText(Tag.id, Id) <span class="pas-kwd">then</span>
    <span class="pas-kwd">begin</span>
      Result := Tag;
      Break;
    <span class="pas-kwd">end</span>;
  <span class="pas-kwd">end</span>;
<span class="pas-kwd">end</span>;</pre>
</div>

<p>
  The routine takes a reference to the <var>IDispatch</var> interface of the
  web browser control's <var>Document</var> object. It returns either the
  <var>IDisptach</var> interface of the tag with the required Id or
  <strong>nil</strong> if no tag with the required id exists. The return value
  can be cast to the required interface of the tag, for e.g.
  <var>IHTMLElement</var> or <var>IHTMLElement2</var>. The comments in the
  code should explain what's happening.
</p>

<h2>
  Example
</h2>

<p>
  Let's try this out. First create a small HTML document containing at least
  one element that has an <var>id</var> attribute. Here's an example that
  we'll name <code>Test.html</code> and store in the same directory as the
  test application:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">&lt;?xml</span> version=<span class="pas-str">&quot;1.0&quot;</span><span class="pas-kwd">?</span>&gt;
&lt;<span class="pas-kwd">!DOCTYPE</span> html
        PUBLIC <span class="pas-str">&quot;//W3C//DTD XHTML 1.0 Strict//EN&quot;</span>
        <span class="pas-str">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</span><span class="pas-kwd">&gt;</span>
<span class="pas-kwd">&lt;html</span> xmlns=<span class="pas-str">&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;</span><span class="pas-kwd">&gt;</span>
  <span class="pas-kwd">&lt;head&gt;</span>
    <span class="pas-kwd">&lt;title&gt;</span>Tip#36 Test<span class="pas-kwd">&lt;/title&gt;</span>
  <span class="pas-kwd">&lt;/head&gt;</span>
  <span class="pas-kwd">&lt;body&gt;</span>
     <span class="pas-kwd">&lt;p&gt;</span>Paragraph with no id<span class="pas-kwd">&lt;/p&gt;</span>
     <span class="pas-kwd">&lt;p</span> id=<span class="pas-str">&quot;myid&quot;</span>&gt;Paragraph with id = myid<span class="pas-kwd">&lt;/p&gt;</span>
  <span class="pas-kwd">&lt;/body&gt;</span>
<span class="pas-kwd">&lt;/html&gt;</span></pre>
</div>

<p>
  Now create a new Delphi application and drop a <var>TWebBrowser</var> and a
  <var>TButton</var> on the form. Add the following <var>OnShow</var> event
  handler to the form to load the test document into the browser:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">procedure</span> TForm1.FormShow(Sender: TObject);
<span class="pas-kwd">begin</span>
  WebBrowser1.Navigate(
    <span class="pas-str">'file:///'</span> + ExtractFilePath(ParamStr(<span class="pas-num">0</span>)) + <span class="pas-str">'test.html'</span>
  );
<span class="pas-kwd">end</span>;</pre>
</div>

<p>
  Next, add an <var>OnClick</var> event handler for the button:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">procedure</span> TForm1.Button1Click(Sender: TObject);
<span class="pas-kwd">var</span>
  Elem: IHTMLElement;
<span class="pas-kwd">begin</span>
  Elem := GetElementById(WebBrowser1.Document, <span class="pas-str">'myid'</span>) <span class="pas-kwd">as</span> IHTMLElement;
  <span class="pas-kwd">if</span> Assigned(Elem) <span class="pas-kwd">then</span>
    ShowMessage(
      <span class="pas-str">'Tag name = &lt;'</span> + Elem.tagName + <span class="pas-str">'&gt;'</span><span class="pas-str">#10</span> +
      <span class="pas-str">'Tag id = '</span> + Elem.id + <span class="pas-str">#10</span> +
      <span class="pas-str">'Tag innerHTML = &quot;'</span> + Elem.innerHTML + <span class="pas-str">'&quot;'</span>
    );
<span class="pas-kwd">end</span>;</pre>
</div>

<p>
  This exercises our <var>GetElementById</var> routine by finding the
  paragraph element with <var>id</var> = &quot;myid&quot; and displays some
  information about the element in a message box.
</p>

<p>
  One use for this code is to change the HTML displayed by a block level tag.
  To illustrate this drop another button on the form and give it the following
  <var>OnClick</var> event handler:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">procedure</span> TForm1.Button2Click(Sender: TObject);
<span class="pas-kwd">var</span>
  Elem: IHTMLElement;
<span class="pas-kwd">begin</span>
  Elem := GetElementById(WebBrowser1.Document, <span class="pas-str">'myid'</span>) <span class="pas-kwd">as</span> IHTMLElement;
  <span class="pas-kwd">if</span> Assigned(Elem) <span class="pas-kwd">then</span>
    Elem.innerHTML := <span class="pas-str">'My new text'</span>;
<span class="pas-kwd">end</span>;</pre>
</div>

<p>
  Run the application the click <var>Button1</var> and note the inner HTML
  displayed in the message box. Now click <var>Button2</var> and watch the
  text of the second paragraph change. If you click <var>Button1</var> you'll
  see the inner HTML has changed.
</p>

<p>
  There's lots more you can do with <var>GetElementById</var> to make your
  documents more dynamic. For example you can change the image displayed by an
  image element. Experiment!
</p>

<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Peter Johnson</td>
  </tr>
  <tr>
    <th scope="row">Contributor:</th>
    <td>Peter Johnson</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2007-10-23</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2007-10-29</td>
  </tr>
</table>

<div class="search noprint">
<form name="tipsSearchForm" id="tipsSearchForm" method="post" action="/tips">
<input class="text" type="text" name="txtSearch" id="txtSearch" value="" size="24" maxlength="80" />
<input class="button" type="submit" name="btnSearch" id="btnSearch" value="Search" />
</form>
</div>
<ul class="tip-nav noprint">
<li><a href="/tips/1">First</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/52">52</a></li>
<li><a href="/tips/53">53</a></li>
<li><a href="/tips/54">54</a></li>
<li><a href="/tips/55">55</a></li>
<li><span class="current">56</span></li>
<li><a href="/tips/57">57</a></li>
<li><a href="/tips/58">58</a></li>
<li><a href="/tips/59">59</a></li>
<li><a href="/tips/60">60</a></li>
<li><span class="spacer">...</span></li>
<li><a href="/tips/234">Last</a></li>
</ul>

<p class="centre-align noprint">
  &laquo; <a href="/tips">Return to contents</a> &raquo;
</p>

</div> <!-- #content -->
</div> <!-- #main -->
<div id="footer">
<div class="hide-from-css"><hr /></div> <!-- .hide-from-css -->
<a href="/copyright">Copyright</a> &copy; Peter Johnson (<a href="/background">DelphiDabbler</a>) 2002-2020</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
