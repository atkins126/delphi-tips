<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Convert between long and short file names</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="Convert between long and short file names" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="stylesheet" href="../css/main.css" />
<script type="text/javascript" src="../js/core.js"></script>
<script type="text/javascript" src="../js/offsite-win.js"></script>
<link rel="stylesheet" href="../css/tips.css" />
<link rel="stylesheet" href="../css/source.css" />
</head>
<body>
<div id="wrapper">

<h1>
	Convert between long and short file names
</h1>

<p>
  Here's a way to convert between short 8.3 DOS file names and long file
  names.
</p>

<p>
  First function will convert long file names to the 8.3 format:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">uses</span>
  Windows, SysUtils;

<span class="pas-kwd">function</span> GetShortName(sLongName: <span class="pas-kwd">string</span>): <span class="pas-kwd">string</span>;
<span class="pas-kwd">var</span>
  sShortName    : <span class="pas-kwd">string</span>;
  nShortNameLen : integer;
<span class="pas-kwd">begin</span>
  SetLength(sShortName, MAX_PATH);
  nShortNameLen := GetShortPathName(
    PChar(sLongName), PChar(sShortName), MAX_PATH - <span class="pas-num">1</span>
  );
  <span class="pas-kwd">if</span> (<span class="pas-num">0</span> = nShortNameLen) <span class="pas-kwd">then</span>
  <span class="pas-kwd">begin</span>
    <span class="pas-comment">// handle errors...</span>
  <span class="pas-kwd">end</span>;
  SetLength(sShortName, nShortNameLen);
  Result := sShortName;
<span class="pas-kwd">end</span>;</pre>
</div>

<p>
  Now a function to convert a short file name into a long file name:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">uses</span>
  Windows, SysUtils;

<span class="pas-kwd">function</span> __GetLongName(sShortName: <span class="pas-kwd">string</span>; <span class="pas-kwd">var</span> bError : boolean): <span class="pas-kwd">string</span>;
<span class="pas-kwd">var</span>
  bAddSlash : boolean;
  SearchRec : TSearchRec;
  nStrLen   : integer;
<span class="pas-kwd">begin</span>
  bError    := False;
  Result    := sShortName;
  nStrLen   := Length(sShortName);
  bAddSlash := False;

  <span class="pas-kwd">if</span>(<span class="pas-str">'\'</span> = sShortName[nStrLen]) <span class="pas-kwd">then</span>
  <span class="pas-kwd">begin</span>
    bAddSlash := True;
    SetLength(sShortName, nStrLen - <span class="pas-num">1</span>);
    dec(nStrLen);
  <span class="pas-kwd">end</span>;

  <span class="pas-kwd">if</span> (nStrLen - Length(ExtractFileDrive(sShortName))) &gt; <span class="pas-num">0</span> <span class="pas-kwd">then</span>
  <span class="pas-kwd">begin</span>
    <span class="pas-kwd">if</span> <span class="pas-num">0</span> = FindFirst(sShortName, faAnyFile, SearchRec) <span class="pas-kwd">then</span>
    <span class="pas-kwd">begin</span>
      Result := ExtractFilePath(sShortName) + SearchRec.<span class="pas-kwd">Name</span>;
      <span class="pas-kwd">if</span> bAddSlash <span class="pas-kwd">then</span>
      <span class="pas-kwd">begin</span>
        Result := Result + <span class="pas-str">'\'</span>;
      <span class="pas-kwd">end</span>;
    <span class="pas-kwd">end</span>
    <span class="pas-kwd">else</span>
    <span class="pas-kwd">begin</span>
      <span class="pas-comment">// handle errors...</span>
      bError := True;
    <span class="pas-kwd">end</span>;
    FindClose(SearchRec);
  <span class="pas-kwd">end</span>;
<span class="pas-kwd">end</span>;

<span class="pas-kwd">function</span> GetLongName(sShortName: <span class="pas-kwd">string</span>): <span class="pas-kwd">string</span>;
<span class="pas-kwd">var</span>
  s      : <span class="pas-kwd">string</span>;
  p      : integer;
  bError : boolean;
<span class="pas-kwd">begin</span>
  Result := sShortName;

  s := <span class="pas-str">''</span>;
  p := Pos(<span class="pas-str">'\'</span>, sShortName);
  <span class="pas-kwd">while</span> p &gt; <span class="pas-num">0</span> <span class="pas-kwd">do</span>
  <span class="pas-kwd">begin</span>
    s := __GetLongName(s + Copy(sShortName, <span class="pas-num">1</span>, p), bError);
    Delete(sShortName, <span class="pas-num">1</span>, p);
    p := Pos(<span class="pas-str">'\'</span>, sShortName);

    <span class="pas-kwd">if</span> bError <span class="pas-kwd">then</span>
      Exit;
  <span class="pas-kwd">end</span>;
  <span class="pas-kwd">if</span> <span class="pas-str">''</span> &lt;&gt; sShortName <span class="pas-kwd">then</span>
  <span class="pas-kwd">begin</span>
    s := __GetLongName(s + sShortName, bError);
    <span class="pas-kwd">if</span> bError <span class="pas-kwd">then</span>
      Exit;
  <span class="pas-kwd">end</span>;
  Result := s;
<span class="pas-kwd">end</span>;</pre>
</div>

<p>
  Let's give our functions a try:
</p>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-kwd">procedure</span> Test;
<span class="pas-kwd">const</span>
  csTest = <span class="pas-str">'C:\Program Files'</span>;
<span class="pas-kwd">var</span>
  sShort,
  sLong: <span class="pas-kwd">string</span>;
<span class="pas-kwd">begin</span>
  sShort := GetShortName(csTest);
  MessageDlg(
    <span class="pas-str">'Short name for &quot;'</span> + csTest + <span class="pas-str">'&quot; is &quot;'</span> + sShort + <span class="pas-str">'&quot;'</span>,
    mtInformation, [mbOk], <span class="pas-num">0</span>
  );
  sLong := GetLongName(sShort);
  MessageDlg(
    <span class="pas-str">'Long name for &quot;'</span> + sShort + <span class="pas-str">'&quot; is &quot;'</span> + sLong + <span class="pas-str">'&quot;'</span>,
     mtInformation, [mbOk], <span class="pas-num">0</span>
  );
<span class="pas-kwd">end</span>;</pre>
</div>

<div class="xref">
  See also the <a href="http://snippets.delphidabbler.com/list?snippets=LongToShortFilePath%2CShortToLongFilePath" title="Off-site link" class="offsite">LongToShortFilePath &amp; ShortToLongFilePath</a> routines in the <a href="http://snippets.delphidabbler.com/" title="Off-site link" class="offsite">Code Snippets Database</a>.
</div>

<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Unknown</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2007-06-02</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2013-10-12</td>
  </tr>
</table>



<div id="footer">
  Copyright &copy; Peter Johnson (<a href="https://gravatar.com/delphidabbler">DelphiDabbler</a>) 2002-2020
</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
