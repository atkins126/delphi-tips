<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<head>
<title>How to convert Delphi forms from binary to text and vice versa</title>
<meta http-equiv="Content-Language" content="en" />
<meta name="description" content="How to convert Delphi forms from binary to text and vice versa" />
<meta name="keywords" content="programming, Delphi, hints, tips, hints and tips" />
<meta name="copyright" content="Copyright (c) 2002-2020 Peter D Johnson" />
<meta name="robots" content="INDEX,FOLLOW" />
<link rel="stylesheet" href="../css/main.css" />
<script type="text/javascript" src="../js/core.js"></script>
<script type="text/javascript" src="../js/offsite-win.js"></script>
<link rel="stylesheet" href="../css/tips.css" />
<link rel="stylesheet" href="../css/source.css" />
</head>
<body>
<div id="wrapper">

<h1>
	How to convert Delphi forms from binary to text and vice versa
</h1>

<p>
  Here are some routines you can use to test and convert between Delphi's
  binary and text form (<code>.dfm</code>) file formats.
</p>

<h2>
  Test for a binary form file
</h2>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-comment">// returns true if dfm file is in a binary format</span>
<span class="pas-kwd">function</span> IsDFMBinary(FileName: <span class="pas-kwd">string</span>): Boolean;
<span class="pas-kwd">var</span>
  F: TFileStream;
  B: Byte;
<span class="pas-kwd">begin</span>
  B := <span class="pas-num">0</span>;
  F := TFileStream.Create(FileName, fmOpenRead);
  <span class="pas-kwd">try</span>
    F.<span class="pas-kwd">Read</span>( B, <span class="pas-num">1</span> );
    Result := B = <span class="pas-hex">$FF</span>;
  <span class="pas-kwd">finally</span>
    F.Free;
  <span class="pas-kwd">end</span>;
<span class="pas-kwd">end</span>;</pre>
</div>

<h2>
  Convert from binary to text and vice versa
</h2>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source"><span class="pas-comment">// convert a binary dfm file to a text dfm file</span>
<span class="pas-kwd">function</span> Dfm2Txt(Src, Dest: <span class="pas-kwd">string</span>): boolean;
<span class="pas-kwd">var</span>
  SrcS, DestS: TFileStream;
<span class="pas-kwd">begin</span>
  <span class="pas-kwd">if</span> Src = Dest <span class="pas-kwd">then</span>
  <span class="pas-kwd">begin</span>
    MessageDlg(<span class="pas-str">'Error converting dfm file to binary!. '</span>
      + <span class="pas-str">'The source file and destination file names are the same.'</span>,
      mtError, [mbOK], <span class="pas-num">0</span>);
    result := False;
    exit;
  <span class="pas-kwd">end</span>;
  SrcS := TFileStream.Create(Src, fmOpenRead);
  DestS := TFileStream.Create(Dest, fmCreate);
  <span class="pas-kwd">try</span>
    ObjectResourceToText(SrcS, DestS);
    <span class="pas-kwd">if</span> FileExists(Src) <span class="pas-kwd">and</span> FileExists(Dest) <span class="pas-kwd">then</span>
      Result := True
    <span class="pas-kwd">else</span>
      Result := False;
  <span class="pas-kwd">finally</span>
    SrcS.Free;
    DestS.Free;
  <span class="pas-kwd">end</span>;
<span class="pas-kwd">end</span>;

<span class="pas-comment">// convert a text DFM file to a binary DFM file</span>
<span class="pas-kwd">function</span> Txt2DFM(Src, Dest: <span class="pas-kwd">string</span>): boolean;
<span class="pas-kwd">var</span>
  SrcS, DestS: TFileStream;
<span class="pas-kwd">begin</span>
  <span class="pas-kwd">if</span> Src = Dest <span class="pas-kwd">then</span>
  <span class="pas-kwd">begin</span>
    MessageDlg(<span class="pas-str">'Error converting dfm file to binary!. '</span>
      + <span class="pas-str">'The source file and destination file names are the same.'</span>,
      mtError, [mbOK], <span class="pas-num">0</span>);
    Result := False;
    exit;
  <span class="pas-kwd">end</span>;
  SrcS := TFileStream.Create(Src, fmOpenRead);
  DestS := TFileStream.Create(Dest, fmCreate);
  <span class="pas-kwd">try</span>
    ObjectTextToResource(SrcS, DestS);
    <span class="pas-kwd">if</span> FileExists(Src) <span class="pas-kwd">and</span> FileExists(Dest) <span class="pas-kwd">then</span>
      Result := True
    <span class="pas-kwd">else</span>
      Result := False;
  <span class="pas-kwd">finally</span>
    SrcS.Free;
    DestS.Free;
  <span class="pas-kwd">end</span>;
<span class="pas-kwd">end</span>;</pre>
</div>

<h2>
  Open a Binary DFM File as a Text Stream
</h2>

<div class="frame">
<!-- Highlighted Pascal code generated by DelphiDabbler PasH -->
<pre class="pas-source">
<span class="pas-comment">/// open a binary DFM file as a text stream</span>
<span class="pas-kwd">function</span> DfmFile2Stream(<span class="pas-kwd">const</span> Src: <span class="pas-kwd">string</span>; Dest: TStream): boolean;
<span class="pas-kwd">var</span>
  SrcS: TFileStream;
<span class="pas-kwd">begin</span>
  SrcS := TFileStream.Create(Src, fmOpenRead <span class="pas-kwd">or</span> fmShareDenyWrite);
  <span class="pas-kwd">try</span>
    ObjectResourceToText(SrcS, Dest);
    Result := True;
  <span class="pas-kwd">finally</span>
    SrcS.Free;
  <span class="pas-kwd">end</span>;
<span class="pas-kwd">end</span>;</pre>
</div>
<table class="infotable">
  <tr>
    <th scope="row">Author:</th>
    <td>Bill Miller</td>
  </tr>
  <tr>
    <th scope="row">Contributor:</th>
    <td>Bill Miller</td>
  </tr>
  <tr>
    <th scope="row">Added:</th>
    <td>2008-06-16</td>
  </tr>
  <tr>
    <th scope="row">Last updated:</th>
    <td>
    2008-06-16</td>
  </tr>
</table>



<div id="footer">
  Copyright &copy; Peter Johnson (<a href="https://gravatar.com/delphidabbler">DelphiDabbler</a>) 2002-2020
</div> <!-- #footer -->
</div> <!-- #wrapper -->
</body>
</html>
